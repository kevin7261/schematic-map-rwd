(function(){"use strict";var e={532:function(e,t,a){var l=a(5130),o=a(657),n=a(6768);const r={id:"app",class:"d-flex flex-column vh-100"},i={class:"d-flex flex-column overflow-hidden"};function s(e,t,a,l,o,s){const c=(0,n.g2)("router-view");return(0,n.uX)(),(0,n.CE)("div",r,[(0,n.Lk)("div",i,[(0,n.bF)(c)])])}var c=a(144),d={name:"App",components:{},setup(){const e=(0,c.KR)(!1),t=(0,c.KR)("載入中..."),a=(0,c.KR)(0),l=(0,c.KR)(!1),o=(0,c.KR)("");return{isLoading:e,loadingText:t,loadingProgress:a,showLoadingProgress:l,loadingSubText:o}}},u=a(1241);const v=(0,u.A)(d,[["render",s]]);var g=v,y=a(1387),m=a(4232);const p={id:"app",class:"d-flex flex-column vh-100"},h={class:"d-flex flex-column overflow-hidden"},f={key:0,class:"h-100"},b={key:1,class:"h-100 d-flex flex-column overflow-hidden"},x={class:"d-none d-xl-flex flex-row overflow-hidden h-100"},k={class:"d-flex d-xl-none flex-column overflow-hidden h-100"},w={class:"d-none d-xl-flex justify-content-between my-app-footer my-title-sm-white my-bgcolor-gray-800 p-2",ref:"appFooterRef"};function L(e,t,a,l,o,r){const i=(0,n.g2)("LoadingOverlay"),s=(0,n.g2)("router-view"),c=(0,n.g2)("LeftView"),d=(0,n.g2)("MiddleView"),u=(0,n.g2)("RightView"),v=(0,n.g2)("UpperView"),g=(0,n.g2)("ResponsiveLowerView");return(0,n.uX)(),(0,n.CE)("div",p,[(0,n.bF)(i,{isVisible:l.isAnyLayerLoading,loadingText:l.loadingText,progress:l.loadingProgress,showProgress:l.showLoadingProgress,subText:l.loadingSubText},null,8,["isVisible","loadingText","progress","showProgress","subText"]),(0,n.Lk)("div",h,["/"!==e.$route.path?((0,n.uX)(),(0,n.CE)("div",f,[(0,n.bF)(s)])):(0,n.Q3)("",!0),"/"===e.$route.path?((0,n.uX)(),(0,n.CE)("div",b,[(0,n.Lk)("div",x,[l.leftViewWidth>0?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"h-100 overflow-y-auto overflow-x-hidden my-left-panel",style:(0,m.Tr)({width:l.leftViewWidthPx})},[(0,n.bF)(c)],4)):(0,n.Q3)("",!0),(0,n.Lk)("div",{class:(0,m.C4)(["my-resizer my-resizer-vertical my-resizer-left",{"my-dragging":l.isSidePanelDragging}]),onMousedown:t[0]||(t[0]=e=>l.startResize("left",e)),title:"拖曳調整左側面板寬度"},null,34),(0,n.bF)(d,{ref:"middlePanelRef",class:"d-flex flex-column overflow-hidden h-100 my-middle-panel",style:(0,m.Tr)([{"z-index":"1"},{width:l.mainPanelWidthPx,"min-width":"0px"}]),dynamicMainAreaHeight:l.calculatedMiddleViewHeight,activeUpperTab:l.activeUpperTab,activeBottomTab:l.activeBottomTab,mainPanelWidth:l.mainPanelWidth,selectedFilter:l.selectedFilter,zoomLevel:l.zoomLevel,currentCoords:l.currentCoords,activeMarkers:l.activeMarkers,isLoadingData:l.isAnyLayerLoading,isSidePanelDragging:l.isSidePanelDragging,"onUpdate:activeUpperTab":t[1]||(t[1]=e=>l.activeUpperTab=e),"onUpdate:activeBottomTab":t[2]||(t[2]=e=>l.activeBottomTab=e),"onUpdate:zoomLevel":t[3]||(t[3]=e=>l.zoomLevel=e),"onUpdate:currentCoords":t[4]||(t[4]=e=>l.currentCoords=e),"onUpdate:activeMarkers":t[5]||(t[5]=e=>l.activeMarkers=e),onResetView:l.resetView,onHighlightOnMap:l.handleHighlight,onHighlightFeature:l.handleHighlight,onFeatureSelected:l.handleFeatureSelected},null,8,["style","dynamicMainAreaHeight","activeUpperTab","activeBottomTab","mainPanelWidth","selectedFilter","zoomLevel","currentCoords","activeMarkers","isLoadingData","isSidePanelDragging","onResetView","onHighlightOnMap","onHighlightFeature","onFeatureSelected"]),(0,n.Lk)("div",{class:(0,m.C4)(["my-resizer my-resizer-vertical my-resizer-right",{"my-dragging":l.isSidePanelDragging}]),onMousedown:t[6]||(t[6]=e=>l.startResize("right",e)),title:"拖曳調整右側面板寬度"},null,34),l.rightViewWidth>0?((0,n.uX)(),(0,n.CE)("div",{key:1,class:"h-100 overflow-auto",style:(0,m.Tr)({width:l.rightViewWidthPx})},[(0,n.bF)(u,{activeRightTab:l.activeRightTab,activeMarkers:l.activeMarkers,rightViewWidth:l.rightViewWidth,"onUpdate:activeRightTab":t[7]||(t[7]=e=>l.activeRightTab=e),onHighlightFeature:l.handleHighlight,"current-coords":l.currentCoords},null,8,["activeRightTab","activeMarkers","rightViewWidth","onHighlightFeature","current-coords"])],4)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",k,[l.mobileBottomViewHeight<100?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"flex-shrink-0 overflow-hidden d-flex flex-column",style:(0,m.Tr)({height:100-l.mobileBottomViewHeight+"vh"})},[((0,n.uX)(),(0,n.Wv)(v,{ref:"mobileUpperViewRef",key:l.mobileMapKey,activeUpperTab:l.activeUpperTab,mainPanelWidth:100,contentHeight:Math.max(400,(100-l.mobileBottomViewHeight)*e.windowHeight*.01),selectedFilter:l.selectedFilter,zoomLevel:l.zoomLevel,isPanelDragging:l.isVerticalDragging,activeMarkers:l.activeMarkers,"onUpdate:activeUpperTab":t[8]||(t[8]=e=>l.activeUpperTab=e),"onUpdate:zoomLevel":t[9]||(t[9]=e=>l.zoomLevel=e),"onUpdate:currentCoords":t[10]||(t[10]=e=>l.currentCoords=e),"onUpdate:activeMarkers":t[11]||(t[11]=e=>l.activeMarkers=e),onFeatureSelected:l.handleFeatureSelected},null,8,["activeUpperTab","contentHeight","selectedFilter","zoomLevel","isPanelDragging","activeMarkers","onFeatureSelected"]))],4)):(0,n.Q3)("",!0),l.mobileBottomViewHeight>0&&l.mobileBottomViewHeight<100?((0,n.uX)(),(0,n.CE)("div",{key:1,class:(0,m.C4)(["my-resizer my-resizer-horizontal my-resizer-middle",{"my-dragging":l.isVerticalDragging}]),onMousedown:t[12]||(t[12]=(...e)=>l.startVerticalResize&&l.startVerticalResize(...e)),onTouchstart:t[13]||(t[13]=(...e)=>l.startVerticalResize&&l.startVerticalResize(...e)),title:"拖曳調整底部面板高度"},null,34)):(0,n.Q3)("",!0),l.mobileBottomViewHeight>0?((0,n.uX)(),(0,n.CE)("div",{key:2,class:"flex-shrink-0 overflow-hidden",style:(0,m.Tr)({height:l.mobileBottomViewHeight+"vh"})},[(0,n.bF)(g,{activeTab:l.activeLowerTab,activeRightTab:l.activeRightTab,activeBottomTab:l.activeBottomTab,"onUpdate:activeTab":t[14]||(t[14]=e=>l.activeLowerTab=e),"onUpdate:activeRightTab":t[15]||(t[15]=e=>l.activeRightTab=e),"onUpdate:activeBottomTab":t[16]||(t[16]=e=>l.activeBottomTab=e),onHighlightOnMap:l.handleHighlight,onHighlightFeature:l.handleHighlight,onFeatureSelected:l.handleFeatureSelected},null,8,["activeTab","activeRightTab","activeBottomTab","onHighlightOnMap","onHighlightFeature","onFeatureSelected"])],4)):(0,n.Q3)("",!0)])])):(0,n.Q3)("",!0)]),(0,n.Lk)("footer",w,t[17]||(t[17]=[(0,n.Lk)("small",null,"臺灣大學地理環境資源學系",-1),(0,n.Lk)("small",null,"2025",-1)]),512)])}a(8111),a(116),a(3579),a(4114),a(2489),a(1701),a(8237);const T={JSON:"/schematic-map-rwd/data",FALLBACK_JSON:"/data"};async function C(e,t=null){console.log(`📁 嘗試載入檔案: ${e}`);try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);return console.log(`✅ 檔案載入成功: ${e}`),t}catch(a){if(console.warn(`⚠️ 主要路徑載入失敗: ${e}`,a.message),t){console.log(`📁 嘗試備用路徑: ${t}`);try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return console.log(`✅ 備用路徑載入成功: ${t}`),e}catch(l){throw console.error(`❌ 備用路徑也載入失敗: ${t}`,l.message),new Error(`無法載入檔案。主要路徑: ${e}, 備用路徑: ${t}。錯誤: ${a.message}`)}}throw new Error(`無法載入檔案: ${e}。錯誤: ${a.message}`)}}async function E(e){try{console.log("🔄 載入數據圖層 JSON 資料...");const t=e.jsonFileName,a=`${T.JSON}/${t}`,l=await C(a),o=await l.json();return await M(o)}catch(t){throw console.error("❌ 數據圖層 JSON 數據載入或處理失敗:",t),t}}function D(e){console.log("🎲 開始隨機化節點數值，原始節點數量:",e.length);const t=e.map((e=>{const t=Math.floor(5*Math.random())+1;return console.log(`🎲 節點 ${e.coord?.x},${e.coord?.y} 從 ${e.value} 變為 ${t}`),{...e,value:t}}));return console.log("🎲 隨機化完成，前3個節點:",t.slice(0,3)),t}async function N(e){try{console.log("📊 載入網格示意圖 JSON 數據:",e.jsonFileName);const t=await C(`${T.JSON}/${e.jsonFileName}`,`${T.FALLBACK_JSON}/${e.jsonFileName}`),a=await t.json();return await I(a)}catch(t){throw console.error("❌ 網格示意圖 JSON 數據載入失敗:",t),t}}async function I(e){console.log("📊 處理網格示意圖數據:",e);const t=parseInt(e.x)||10,a=parseInt(e.y)||10;console.log(`📊 網格尺寸: ${t} x ${a}`);const l=[];for(let i=0;i<a;i++)for(let e=0;e<t;e++)l.push({x:e,y:i,value:Math.floor(5*Math.random())+1,type:1,coord:{x:e,y:i}});const o={totalNodes:t*a,gridSize:`${t} x ${a}`,gridX:t,gridY:a,nodeCount:l.length},n={totalNodes:t*a,gridSize:`${t} x ${a}`,gridX:t,gridY:a},r=[{"#":1,name:`網格示意圖 (${t}x${a})`,gridSize:`${t} x ${a}`,totalNodes:t*a,nodes:l}];return{jsonData:e,processedJsonData:{gridX:t,gridY:a,nodes:l,type:"grid"},dashboardData:o,dataTableData:r,layerInfoData:n}}async function M(e){if(Array.isArray(e)&&e.length>0&&e[0].nodes){console.log("📊 載入示意圖節點數據，共",e.length,"條路線");const t=e.map((e=>({...e,nodes:D(e.nodes)}))),a={totalLines:t.length,totalNodes:t.reduce(((e,t)=>e+t.nodes.length),0),lineNames:t.map((e=>e.name))},l={totalLines:t.length,totalNodes:t.reduce(((e,t)=>e+t.nodes.length),0),lineNames:t.map((e=>e.name))},o=t.map(((e,t)=>({"#":t+1,color:e.color,name:e.name,nodes:e.nodes})));return{jsonData:e,processedJsonData:t,dashboardData:a,dataTableData:o,layerInfoData:l}}console.log("📊 載入標準 JSON 數據，共",e.length,"個項目");const t={totalCount:e.length,itemNames:e.map((e=>e.name||e.id||"未命名項目"))},a={totalItems:e.length,itemNames:e.map((e=>e.name||e.id||"未命名項目")),hasFeatures:e.some((e=>e.features)),hasProperties:e.some((e=>e.properties))};return{jsonData:e,processedJsonData:e,dashboardData:t,layerInfoData:a,dataTableData:e.map(((e,t)=>({"#":t+1,name:e.name||e.id||"未命名項目",...e})))}}const R=(0,o.nY)("data",(()=>{const e=(0,c.KR)({}),t=(0,c.KR)([{groupName:"測試圖層",groupLayers:[{layerId:"test_layer",layerName:"網格示意圖測試",visible:!1,isLoading:!1,isLoaded:!1,type:"grid",shape:null,colorName:"green",jsonData:null,processedJsonData:null,dashboardData:null,dataTableData:null,layerInfoData:null,jsonLoader:N,jsonFileName:"test/test.json",isDataLayer:!0,hideFromMap:!0,display:!0,isGridSchematic:!0}]},{groupName:"數據圖層",groupLayers:[{layerId:"taipei_metro",layerName:"Taipei Metro",visible:!1,isLoading:!1,isLoaded:!1,type:"point",shape:null,colorName:"orange",jsonData:null,processedJsonData:null,dashboardData:null,dataTableData:null,layerInfoData:null,jsonLoader:E,jsonFileName:"taipei/taipei_schematic.json",isDataLayer:!0,hideFromMap:!0,display:!0},{layerId:"taipei_metro_2",layerName:"Taipei Metro 2",visible:!1,isLoading:!1,isLoaded:!1,type:"point",shape:null,colorName:"orange",jsonData:null,processedJsonData:null,dashboardData:null,dataTableData:null,layerInfoData:null,jsonLoader:E,jsonFileName:"taipei/taipei_schematic_2.json",isDataLayer:!0,hideFromMap:!0,display:!0}]}]),a=(t,a)=>{e.value[t]||(e.value[t]={}),Object.assign(e.value[t],a)},l=e=>{for(const a of t.value)for(const t of a.groupLayers)if(t.layerId===e)return t;return null},o=()=>{const e=[];for(const a of t.value)e.push(...a.groupLayers);return e},r=async e=>{const t=l(e);if(!t)return void console.error(`❌ DataStore: Layer with id "${e}" not found.`);console.log("🔧 DataStore: 找到圖層",{layerId:e,layerName:t.layerName,currentVisible:t.visible,isLoaded:t.isLoaded,isLoading:t.isLoading}),t.visible=!t.visible,a(e,{visible:t.visible});const o=t.visible&&!t.isLoaded&&!t.isLoading;if(console.log("🔧 DataStore: 載入條件檢查",{visible:t.visible,isLoaded:t.isLoaded,isLoading:t.isLoading,shouldLoad:o}),o)try{t.isLoading=!0,a(e,{isLoading:t.isLoading});const l=await t.jsonLoader(t);t.jsonData=l.jsonData,t.processedJsonData=l.processedJsonData,t.dataTableData=l.dataTableData,t.dashboardData=l.dashboardData,t.layerInfoData=l.layerInfoData,t.isLoaded=!0,console.log(`✅ 圖層 "${t.layerName}" 載入完成`),console.log("📊 圖層儀表板資料:",t.dashboardData),a(e,{isLoaded:t.isLoaded,jsonData:t.jsonData,processedJsonData:t.processedJsonData,dataTableData:t.dataTableData,dashboardData:t.dashboardData,layerInfoData:t.layerInfoData})}catch(n){console.error(`❌ 載入圖層 "${t.layerName}" 失敗:`,n),t.visible=!1,a(e,{visible:!1})}finally{t.isLoading=!1,a(e,{isLoading:!1})}},i=(0,c.KR)(null),s=(0,c.KR)({width:0,height:0}),d=(e,t)=>{s.value={width:Math.round(e),height:Math.round(t)},console.log("📏 D3jsTab 尺寸更新:",s.value)},u=e=>{e?console.log("🎯 DataStore: 設置選中要素:",e.properties?.id):console.log("🗑️ DataStore: 清除選中要素"),i.value=e},v=()=>{console.log("🗑️ DataStore: 清除選中要素"),i.value=null},g=e=>{for(const a of t.value)for(const t of a.groupLayers)if(t.layerId===e)return a.groupName;return null};return{layers:t,findLayerById:l,getAllLayers:o,findGroupNameByLayerId:g,toggleLayerVisibility:r,selectedFeature:i,setSelectedFeature:u,clearSelectedFeature:v,visibleLayers:(0,n.EW)((()=>o().filter((e=>e.visible)))),loadingLayers:(0,n.EW)((()=>o().filter((e=>e.isLoading)))),layerStates:e,saveLayerState:a,d3jsDimensions:s,updateD3jsDimensions:d}}),{persist:!0}),F={key:0,class:"position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{"background-color":"rgba(0, 0, 0, 0.7)","z-index":"9999"}},_={class:"text-center my-bgcolor-white p-4 rounded shadow",style:{"min-width":"300px","max-width":"400px"}},X={class:"my-title-lg-black"},S={key:0,class:"mt-3"},V={class:"progress",style:{height:"8px"}},j=["aria-valuenow"],$={key:1,class:"mt-2"},z={class:"my-content-xs-gray"};function P(e,t,a,l,o,r){return a.isVisible?((0,n.uX)(),(0,n.CE)("div",F,[(0,n.Lk)("div",_,[t[0]||(t[0]=(0,n.Lk)("div",{class:"spinner-border text-primary mb-3",style:{width:"2rem",height:"2rem"},role:"status"},[(0,n.Lk)("span",{class:"visually-hidden"},"載入中...")],-1)),(0,n.Lk)("div",X,(0,m.v_)(a.loadingText),1),a.showProgress&&a.progress>=0?((0,n.uX)(),(0,n.CE)("div",S,[(0,n.Lk)("div",V,[(0,n.Lk)("div",{class:"progress-bar bg-primary d-flex align-items-center justify-content-center",role:"progressbar",style:(0,m.Tr)([{width:a.progress+"%"},{transition:"width 0.3s ease","font-size":"0.75rem",color:"white"}]),"aria-valuenow":a.progress,"aria-valuemin":"0","aria-valuemax":"100"},(0,m.v_)(Math.round(a.progress))+"% ",13,j)])])):(0,n.Q3)("",!0),a.subText?((0,n.uX)(),(0,n.CE)("div",$,[(0,n.Lk)("small",z,(0,m.v_)(a.subText),1)])):(0,n.Q3)("",!0)])])):(0,n.Q3)("",!0)}var H={name:"LoadingOverlay",props:{isVisible:{type:Boolean,default:!1,required:!0},loadingText:{type:String,default:"載入中..."},progress:{type:Number,default:-1,validator:e=>e>=-1&&e<=100},showProgress:{type:Boolean,default:!1},subText:{type:String,default:""}}};const W=(0,u.A)(H,[["render",P]]);var K=W;const B={class:"my-bgcolor-gray-100 h-100 d-flex flex-column overflow-hidden"},A={class:"flex-grow-1 overflow-hidden"};function U(e,t,a,l,o,r){const i=(0,n.g2)("LayersTab");return(0,n.uX)(),(0,n.CE)("div",B,[t[0]||(t[0]=(0,n.Lk)("div",{class:"p-3"},[(0,n.Lk)("h1",{class:"my-font-size-lg my-letter-spacing-lg text-center m-3"},"Schematic Map")],-1)),(0,n.Lk)("div",A,[(0,n.bF)(i)])])}const O={class:"h-100 d-flex flex-column overflow-hidden my-bgcolor-gray-100"},J={class:"flex-grow-1 overflow-auto layer-list-container",ref:"layerListRef"},G={class:"mb-3"},Q={class:"d-flex align-items-center pb-2"},Y={class:"my-title-xs-gray"},q={class:"btn rounded-0 border-0 d-flex shadow-sm my-bgcolor-white-hover p-0"},Z={class:"w-100"},ee={class:"d-flex"},te=["onClick"],ae={class:"my-content-sm-black"},le={class:"my-content-xs-gray ms-2"},oe=["id","checked","disabled","onChange"],ne=["for"];function re(e,t,a,o,r,i){return(0,n.uX)(),(0,n.CE)("div",O,[(0,n.Lk)("div",J,[(0,n.Lk)("div",G,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.layers,(e=>((0,n.uX)(),(0,n.CE)("div",{key:e.groupName,class:"p-3"},[(0,n.Lk)("div",Q,[(0,n.Lk)("div",Y,(0,m.v_)(e.groupName),1)]),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(e.groupLayers,(e=>((0,n.uX)(),(0,n.CE)("div",{key:e.layerId,class:"mb-1"},[(0,n.Lk)("div",q,[(0,n.Lk)("div",{class:(0,m.C4)(`my-bgcolor-${e.colorName}`),style:{"min-width":"6px"}},null,2),(0,n.Lk)("div",Z,[(0,n.Lk)("div",ee,[(0,n.Lk)("div",{class:"d-flex align-items-center text-start w-100 px-3 py-2 cursor-pointer",onClick:t=>o.toggleLayer(e.layerId)},[(0,n.Lk)("span",ae,[(0,n.eW)((0,m.v_)(e.layerName)+" ",1),(0,n.Lk)("span",le,(0,m.v_)(e.dashboardData?.totalCount),1)])],8,te),(0,n.Lk)("div",{class:"d-flex align-items-center justify-content-center px-3 py-2",onClick:t[0]||(t[0]=(0,l.D$)((()=>{}),["stop"]))},[(0,n.Lk)("input",{type:"checkbox",id:"switch-"+e.layerId,checked:e.visible,disabled:e.isLoading,onChange:t=>o.handleToggleChange(e.layerId,t)},null,40,oe),(0,n.Lk)("label",{for:"switch-"+e.layerId},null,8,ne)])])])])])))),128))])))),128))])],512)])}a(531);var ie={name:"LayersTab",setup(){const e=R(),t=(0,c.KR)(null),a=(0,n.EW)((()=>e.layers)),l=t=>{console.log("🔘 LayersTab: 切換圖層",t),e.toggleLayerVisibility(t)},o=(t,a)=>{a.stopPropagation();const l=e.layers.flatMap((e=>e.groupLayers)).find((e=>e.layerId===t));l?(console.log("🎛️ LayersTab: 開關變更觸發",{layerId:t,layerName:l.layerName,currentVisible:l.visible,targetChecked:a.target.checked,isLoaded:l.isLoaded,isLoading:l.isLoading}),l.visible!==a.target.checked?(console.log("🎛️ LayersTab: 執行圖層切換",t,"新狀態:",a.target.checked),e.toggleLayerVisibility(t)):console.log("🎛️ LayersTab: 狀態已一致，跳過切換",t)):console.error("❌ LayersTab: 找不到圖層",t)};return{layers:a,layerListRef:t,toggleLayer:l,handleToggleChange:o}}};const se=(0,u.A)(ie,[["render",re],["__scopeId","data-v-0fa39767"]]);var ce=se,de={name:"LeftView",components:{LayersTab:ce},setup(){return{}}};const ue=(0,u.A)(de,[["render",U]]);var ve=ue;const ge={class:"my-right-panel h-100 d-flex flex-column overflow-hidden"},ye={class:"d-flex justify-content-center my-bgcolor-gray-200 p-3"},me={class:"d-flex align-items-center rounded-pill shadow my-blur gap-2 p-2 w-100"},pe=["onClick","title"],he={class:"flex-grow-1 overflow-auto"},fe={class:"h-100"},be={class:"h-100"};function xe(e,t,a,o,r,i){const s=(0,n.g2)("PropertiesTab"),c=(0,n.g2)("LayerInfo");return(0,n.uX)(),(0,n.CE)("div",ge,[(0,n.Lk)("div",ye,[(0,n.Lk)("div",me,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.availableTabs,(t=>((0,n.uX)(),(0,n.CE)("button",{key:t.id,class:(0,m.C4)(["btn rounded-pill border-0 my-btn-transparent my-font-size-xs text-nowrap w-100 my-cursor-pointer",{"my-btn-blue":e.$props.activeRightTab===t.id}]),onClick:e=>o.switchTab(t.id),title:t.name},(0,m.v_)(t.name),11,pe)))),128))])]),(0,n.Lk)("div",he,[(0,n.bo)((0,n.Lk)("div",fe,[(0,n.bF)(s,{"selected-feature":o.selectedFeature,onHighlightFeature:t[0]||(t[0]=t=>e.$emit("highlight-feature",t))},null,8,["selected-feature"])],512),[[l.aG,"properties"===e.$props.activeRightTab]]),(0,n.bo)((0,n.Lk)("div",be,[(0,n.bF)(c)],512),[[l.aG,"layer-info"===e.$props.activeRightTab]])])])}const ke={class:"h-100 flex-grow-1 d-flex flex-column my-bgcolor-gray-200"},we={key:0,class:"my-bgcolor-white h-100"},Le={class:"p-3"},Te={class:"pb-2"},Ce={class:"my-content-sm-black pb-1"},Ee={key:0,class:"my-title-xs-gray"},De={key:1,class:"flex-grow-1 d-flex align-items-center justify-content-center"};function Ne(e,t,a,l,o,r){const i=(0,n.g2)("DetailItem");return(0,n.uX)(),(0,n.CE)("div",ke,[l.selectedFeature?((0,n.uX)(),(0,n.CE)("div",we,[(0,n.Lk)("div",null,[l.selectedLayer?((0,n.uX)(),(0,n.CE)("div",{key:0,class:(0,m.C4)("custom"===l.selectedLayer.colorName?"":`my-bgcolor-${l.selectedLayer.colorName}`),style:(0,m.Tr)({minHeight:"4px",backgroundColor:"custom"===l.selectedLayer.colorName?l.selectedLayer.customColor:void 0})},null,6)):(0,n.Q3)("",!0),(0,n.Lk)("div",Le,[(0,n.Lk)("div",Te,[t[0]||(t[0]=(0,n.Lk)("div",{class:"my-title-xs-gray pb-1"},"圖層",-1)),(0,n.Lk)("div",Ce,[l.layerName?.groupName?((0,n.uX)(),(0,n.CE)("span",Ee,(0,m.v_)(l.layerName.groupName)+" - ",1)):(0,n.Q3)("",!0),(0,n.Lk)("span",null,(0,m.v_)(l.layerName?.layerName||l.layerName),1)])]),l.hasProperties?((0,n.uX)(!0),(0,n.CE)(n.FK,{key:0},(0,n.pI)(l.selectedFeature.properties.propertyData,((e,t)=>((0,n.uX)(),(0,n.Wv)(i,{key:t,label:t,value:r.formatValue(e)},null,8,["label","value"])))),128)):(0,n.Q3)("",!0)])])])):((0,n.uX)(),(0,n.CE)("div",De,t[1]||(t[1]=[(0,n.Lk)("div",{class:"text-center"},[(0,n.Lk)("div",{class:"my-title-md-gray p-3"},"沒有點擊地圖上的物件")],-1)])))])}const Ie={class:"pb-2"},Me={class:"my-title-xs-gray pb-1"},Re={class:"my-content-sm-black pb-1"};function Fe(e,t,a,l,o,r){return(0,n.uX)(),(0,n.CE)("div",Ie,[(0,n.Lk)("div",Me,(0,m.v_)(a.label),1),(0,n.Lk)("div",Re,(0,m.v_)(a.value),1)])}var _e={name:"DetailItem",props:{label:{type:String,required:!0},value:{type:[String,Number,Boolean,Object],required:!0}}};const Xe=(0,u.A)(_e,[["render",Fe],["__scopeId","data-v-c153d010"]]);var Se=Xe,Ve={name:"PropertiesTab",components:{DetailItem:Se},setup(){const e=R(),t=(0,n.EW)((()=>e.selectedFeature)),a=(0,n.EW)((()=>{if(!t.value?.properties?.layerId)return null;const a=t.value.properties.layerId;if("datatable"===a){const e=t.value.properties.itemColor;return{colorName:"custom",layerName:"地鐵線路數據",customColor:e||"#6c757d"}}const l=e.findLayerById(a);return l})),l=(0,n.EW)((()=>{if(!t.value?.properties?.layerId)return null;const a=t.value.properties.layerId;if("datatable"===a)return{groupName:"數據表格",layerName:"地鐵線路數據"};const l=e.findLayerById(a);if(!l)return a;const o=e.findGroupNameByLayerId(a);return{groupName:o,layerName:l.layerName}})),o=(0,n.EW)((()=>!!t.value?.properties?.propertyData&&Object.keys(t.value.properties.propertyData).length>0));return{selectedFeature:t,selectedLayer:a,layerName:l,hasProperties:o}},methods:{formatValue(e){return"number"===typeof e?e.toLocaleString():e}}};const je=(0,u.A)(Ve,[["render",Ne]]);var $e=je;const ze={chart_line:{zh:"線圖",en:"Line Chart",icon:'<i class="fas fa-chart-line"></i>'},chart_bar:{zh:"長條圖",en:"Bar Chart",icon:'<i class="fas fa-chart-bar"></i>'},spinner:{zh:"載入中",en:"Loading",icon:'<i class="fas fa-spinner"></i>'},sort:{zh:"排序",en:"Sort",icon:'<i class="fas fa-sort"></i>'},sort_up:{zh:"升序",en:"Sort Ascending",icon:'<i class="fas fa-sort-up"></i>'},sort_down:{zh:"降序",en:"Sort Descending",icon:'<i class="fas fa-sort-down"></i>'},info_circle:{zh:"資訊",en:"Information",icon:'<i class="fas fa-info-circle"></i>'},location_dot:{zh:"位置",en:"Location",icon:'<i class="fa-solid fa-location-dot"></i>'},layer_group:{zh:"圖層",en:"Layer Group",icon:'<i class="fas fa-layer-group"></i>'},table:{zh:"表格",en:"Table",icon:'<i class="fas fa-table"></i>'}};function Pe(e,t="zh"){const a=ze[e];if(!a)return{text:e,icon:"fas fa-question-circle"};const l=a.icon.match(/class="([^"]+)"/),o=l?l[1]:"fas fa-question-circle";return{text:a[t]||a.zh,icon:o}}function He(e,t=""){const a=ze[e];return a?t?a.icon.replace(/class="([^"]+)"/,`class="$1 ${t}"`):a.icon:`<i class="fas fa-question-circle${t?" "+t:""}"></i>`}const We={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},Ke={key:0,class:""},Be={class:"nav nav-tabs nav-fill"},Ae=["onClick"],Ue={key:0,class:"my-title-xs-gray"},Oe={class:"my-title-sm-black"},Je={key:1,class:"my-bgcolor-white h-100"},Ge={class:"p-3"},Qe={key:0,class:"pb-2"},Ye={class:"my-content-sm-black pb-1"},qe=["innerHTML"],Ze={class:"my-title-xs-gray pb-1"},et={class:"my-content-sm-black pb-1"},tt={key:0},at={key:1},lt={key:2,class:"pb-2"},ot={class:"my-content-sm-black pb-1"},nt={key:0,class:"my-content-xs-gray pb-1"},rt={key:3,class:"pb-2"},it={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var st={__name:"layerInfoTab",setup(e){const t=R(),a=(0,c.KR)(null),l=(0,c.KR)(null),o=(0,c.KR)(!1),r=(0,n.EW)((()=>{const e=t.getAllLayers();return e.filter((e=>e.visible))})),i=e=>{a.value=e},s=e=>{if(!e)return{groupName:null,layerName:"未知圖層"};const a=t.findGroupNameByLayerId(e.layerId);return{groupName:a,layerName:e.layerName}},d=()=>{if(!a.value)return null;const e=r.value.find((e=>e.layerId===a.value));return e&&e.layerInfoData||null},u=(0,c.KR)([]);(0,n.wB)((()=>r.value),(e=>{if(0===e.length)return a.value=null,l.value=null,void(u.value=[]);const t=u.value.map((e=>e.layerId)),o=e.map((e=>e.layerId)),n=o.filter((e=>!t.includes(e)));if(n.length>0){const e=n[n.length-1];a.value=e}else a.value&&e.find((e=>e.layerId===a.value))||(a.value=e[0].layerId);u.value=[...e]}),{deep:!0,immediate:!0}),(0,n.wB)((()=>a.value),(e=>{if(e){const a=t.findLayerById(e);a&&a.processedJsonData&&v(a)}else l.value=null}),{immediate:!0});const v=async e=>{if(e&&e.processedJsonData){o.value=!0;try{await new Promise((e=>setTimeout(e,500)));const t=e.processedJsonData.features,a={totalFeatures:t.length,totalPopulation:t.reduce(((e,t)=>e+(t.properties.P_CNT||0)),0),totalCount:t.reduce(((e,t)=>e+(t.properties.count||0)),0),avgPopulation:0,avgCount:0};a.totalFeatures>0&&(a.avgPopulation=a.totalPopulation/a.totalFeatures,a.avgCount=a.totalCount/a.totalFeatures),l.value={layerName:e.layerName,timestamp:(new Date).toLocaleString(),statistics:a},console.log("圖層資訊載入完成:",l.value)}catch(t){console.error("載入圖層資訊失敗:",t),l.value={error:"載入過程中發生錯誤",details:t.message}}finally{o.value=!1}}else console.warn("無法載入資訊：圖層數據不存在")};return(0,n.sV)((()=>{r.value.length>0&&!a.value&&(a.value=r.value[0].layerId)})),(e,u)=>((0,n.uX)(),(0,n.CE)("div",We,[r.value.length>0?((0,n.uX)(),(0,n.CE)("div",Ke,[(0,n.Lk)("ul",Be,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(r.value,(e=>((0,n.uX)(),(0,n.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,n.Lk)("div",{class:(0,m.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:a.value===e.layerId}]),onClick:t=>i(e.layerId)},[(0,n.Lk)("span",null,[s(e).groupName?((0,n.uX)(),(0,n.CE)("span",Ue,(0,m.v_)(s(e).groupName)+" - ",1)):(0,n.Q3)("",!0),(0,n.Lk)("span",Oe,(0,m.v_)(s(e).layerName),1)])],10,Ae),(0,n.Lk)("div",{class:(0,m.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)])))),128))])])):(0,n.Q3)("",!0),r.value.length>0?((0,n.uX)(),(0,n.CE)("div",Je,[(0,n.Lk)("div",null,[(0,n.Lk)("div",Ge,[o.value?((0,n.uX)(),(0,n.CE)("div",Qe,[u[1]||(u[1]=(0,n.Lk)("div",{class:"my-title-xs-gray pb-1"},"載入狀態",-1)),(0,n.Lk)("div",Ye,[(0,n.Lk)("span",{innerHTML:(0,c.R1)(He)("spinner","fa-spin me-2")},null,8,qe),u[0]||(u[0]=(0,n.eW)(" 正在載入圖層資訊... "))])])):(0,n.Q3)("",!0),r.value.length>0&&d()?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(d(),((e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t,class:"pb-2"},[(0,n.Lk)("div",Ze,(0,m.v_)(t),1),(0,n.Lk)("div",et,[Array.isArray(e)?((0,n.uX)(),(0,n.CE)("span",tt,(0,m.v_)(e.join(", ")),1)):((0,n.uX)(),(0,n.CE)("span",at,(0,m.v_)(e),1))])])))),128)),(0,n.bF)(Se,{label:"D3js Width",value:(0,c.R1)(t).d3jsDimensions.width+"px"},null,8,["value"]),(0,n.bF)(Se,{label:"D3js Height",value:(0,c.R1)(t).d3jsDimensions.height+"px"},null,8,["value"])],64)):l.value&&l.value.error?((0,n.uX)(),(0,n.CE)("div",lt,[u[2]||(u[2]=(0,n.Lk)("div",{class:"my-title-xs-gray pb-1"},"載入錯誤",-1)),(0,n.Lk)("div",ot,(0,m.v_)(l.value.error),1),l.value.details?((0,n.uX)(),(0,n.CE)("div",nt," 詳細信息："+(0,m.v_)(l.value.details),1)):(0,n.Q3)("",!0)])):o.value?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("div",rt,u[3]||(u[3]=[(0,n.Lk)("div",{class:"my-title-xs-gray pb-1"},"載入狀態",-1),(0,n.Lk)("div",{class:"my-content-sm-black pb-1"},"等待圖層數據載入...",-1)])))])])])):((0,n.uX)(),(0,n.CE)("div",it,u[4]||(u[4]=[(0,n.Lk)("div",{class:"text-center"},[(0,n.Lk)("div",{class:"my-title-md-gray p-3"},"沒有開啟的圖層")],-1)])))]))}};const ct=st;var dt=ct,ut={name:"RightView",components:{PropertiesTab:$e,LayerInfo:dt},props:{activeRightTab:{type:String,default:"layer-info"},analysisList:{type:Array,default:()=>[]},selectedAnalysisId:{type:[Number,String],default:null},rightViewWidth:{type:Number,default:250}},emits:["update:activeRightTab","select-analysis","view-analysis","delete-analysis","highlight-feature"],setup(e,{emit:t}){const a=R(),l=[{id:"layer-info",name:"圖層資訊",icon:Pe("info_circle").icon},{id:"properties",name:"屬性",icon:Pe("location_dot").icon}],o=e=>{t("update:activeRightTab",e)},r=()=>e.analysisList.filter((e=>"完成"===e.status)).length;(0,n.wB)((()=>a.selectedFeature),(e=>{console.log("RightView - selectedFeature changed:",{newFeature:e,properties:e?.properties,store:a})}),{immediate:!0});const i=(0,n.EW)((()=>{const e=a.selectedFeature;return console.log("RightView - Computing selectedFeature:",{feature:e,properties:e?.properties}),e}));return{availableTabs:l,switchTab:o,getActiveAnalysisCount:r,selectedFeature:i}}};const vt=(0,u.A)(ut,[["render",xe]]);var gt=vt;const yt={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},mt={class:"flex-grow-1 overflow-hidden position-relative"},pt={class:"position-absolute top-0 start-0 m-3",style:{"z-index":"1000"}},ht={class:"d-flex align-items-center rounded-pill shadow my-blur gap-1 p-2"},ft={ref:"d3jsContainerRef",class:"h-100 overflow-hidden pt-5"},bt={ref:"dashboardContainerRef",class:"h-100 overflow-hidden pt-5"},xt={ref:"processedJsonDataContainerRef",class:"h-100 overflow-hidden pt-5"},kt={ref:"jsonDataContainerRef",class:"h-100 overflow-hidden pt-5"};function wt(e,t,a,o,r,i){const s=(0,n.g2)("D3jsTab"),c=(0,n.g2)("DashboardTab"),d=(0,n.g2)("ProcessedJsonDataTab"),u=(0,n.g2)("JsonDataTab");return(0,n.uX)(),(0,n.CE)("div",yt,[(0,n.Lk)("div",mt,[(0,n.Lk)("div",pt,[(0,n.Lk)("div",ht,[(0,n.Lk)("button",{class:(0,m.C4)(["btn rounded-circle border-0 d-flex align-items-center justify-content-center my-btn-transparent my-font-size-xs",{"my-btn-blue":"d3js"===a.activeUpperTab}]),onClick:t[0]||(t[0]=t=>e.$emit("update:activeUpperTab","d3js")),style:{width:"30px",height:"30px"},title:"D3.js 數據視覺化"},[(0,n.Lk)("i",{class:(0,m.C4)(o.getIcon("chart_line").icon)},null,2)],2),(0,n.Lk)("button",{class:(0,m.C4)(["btn rounded-circle border-0 d-flex align-items-center justify-content-center my-btn-transparent my-font-size-xs",{"my-btn-blue":"dashboard"===a.activeUpperTab}]),onClick:t[1]||(t[1]=t=>e.$emit("update:activeUpperTab","dashboard")),style:{width:"30px",height:"30px"},title:"資料儀表板"},[(0,n.Lk)("i",{class:(0,m.C4)(o.getIcon("chart_bar").icon)},null,2)],2),(0,n.Lk)("button",{class:(0,m.C4)(["btn rounded-circle border-0 d-flex align-items-center justify-content-center my-btn-transparent my-font-size-xs",{"my-btn-blue":"processed-json-data"===a.activeUpperTab}]),onClick:t[2]||(t[2]=t=>e.$emit("update:activeUpperTab","processed-json-data")),style:{width:"30px",height:"30px"},title:"處理後 JSON 數據"},t[4]||(t[4]=[(0,n.Lk)("i",{class:"fas fa-code"},null,-1)]),2),(0,n.Lk)("button",{class:(0,m.C4)(["btn rounded-circle border-0 d-flex align-items-center justify-content-center my-btn-transparent my-font-size-xs",{"my-btn-blue":"json-data"===a.activeUpperTab}]),onClick:t[3]||(t[3]=t=>e.$emit("update:activeUpperTab","json-data")),style:{width:"30px",height:"30px"},title:"原始 JSON 數據"},t[5]||(t[5]=[(0,n.Lk)("i",{class:"fas fa-file-code"},null,-1)]),2)])]),(0,n.bo)((0,n.Lk)("div",ft,[t[6]||(t[6]=(0,n.Lk)("div",{style:{height:"40px"}},null,-1)),(0,n.bF)(s,{ref:"D3jsTab",containerHeight:a.contentHeight,isPanelDragging:a.isPanelDragging,activeMarkers:a.activeMarkers},null,8,["containerHeight","isPanelDragging","activeMarkers"])],512),[[l.aG,"d3js"===a.activeUpperTab]]),(0,n.bo)((0,n.Lk)("div",bt,[t[7]||(t[7]=(0,n.Lk)("div",{style:{height:"40px"}},null,-1)),(0,n.bF)(c,{ref:"DashboardTab",containerHeight:a.contentHeight,isPanelDragging:a.isPanelDragging,activeMarkers:a.activeMarkers},null,8,["containerHeight","isPanelDragging","activeMarkers"])],512),[[l.aG,"dashboard"===a.activeUpperTab]]),(0,n.bo)((0,n.Lk)("div",xt,[t[8]||(t[8]=(0,n.Lk)("div",{style:{height:"40px"}},null,-1)),(0,n.bF)(d,{ref:"ProcessedJsonDataTab",containerHeight:a.contentHeight,isPanelDragging:a.isPanelDragging,activeMarkers:a.activeMarkers},null,8,["containerHeight","isPanelDragging","activeMarkers"])],512),[[l.aG,"processed-json-data"===a.activeUpperTab]]),(0,n.bo)((0,n.Lk)("div",kt,[t[9]||(t[9]=(0,n.Lk)("div",{style:{height:"40px"}},null,-1)),(0,n.bF)(u,{ref:"JsonDataTab",containerHeight:a.contentHeight,isPanelDragging:a.isPanelDragging,activeMarkers:a.activeMarkers},null,8,["containerHeight","isPanelDragging","activeMarkers"])],512),[[l.aG,"json-data"===a.activeUpperTab]])])])}const Lt={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},Tt={key:0,class:""},Ct={class:"nav nav-tabs nav-fill"},Et=["onClick"],Dt={key:0,class:"my-title-xs-gray"},Nt={class:"my-title-sm-black"},It={key:1,class:"flex-grow-1 overflow-auto my-bgcolor-white p-3"},Mt={class:"mb-4"},Rt={class:"my-title-md-black"},Ft={key:0},_t={class:"rounded-4 my-bgcolor-gray-100 p-4 mb-3"},Xt={class:"my-font-size-sm",style:{"white-space":"pre-wrap","word-wrap":"break-word","max-height":"500px","overflow-y":"auto"}},St={key:1,class:"text-center py-5"},Vt={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var jt={__name:"DashboardTab",setup(e){const t=R(),a=(0,c.KR)(null),l=(0,n.EW)((()=>{const e=t.getAllLayers();return e.filter((e=>e.visible))})),o=e=>{a.value=e},r=(0,n.EW)((()=>{if(!a.value)return null;const e=l.value.find((e=>e.layerId===a.value));return e&&e.dashboardData||null})),i=(0,n.EW)((()=>{if(!a.value)return"無開啟圖層";const e=l.value.find((e=>e.layerId===a.value));return e?e.layerName||"未知圖層":"無開啟圖層"})),s=e=>{if(!e)return{groupName:null,layerName:"未知圖層"};const a=t.findGroupNameByLayerId(e.layerId);return{groupName:a,layerName:e.layerName}},d=(0,c.KR)([]);return(0,n.wB)((()=>l.value),(e=>{if(0===e.length)return a.value=null,void(d.value=[]);const t=d.value.map((e=>e.layerId)),l=e.map((e=>e.layerId)),o=l.filter((e=>!t.includes(e)));if(o.length>0){const t=o[o.length-1];a.value=t,console.log(`🔄 自動切換到新開啟的圖層: ${e.find((e=>e.layerId===t))?.layerName}`)}else a.value&&e.find((e=>e.layerId===a.value))||(a.value=e[0].layerId);d.value=[...e]}),{deep:!0,immediate:!0}),(0,n.sV)((()=>{console.log("[DashboardTab] Component Mounted"),l.value.length>0&&!a.value&&(a.value=l.value[0].layerId)})),(e,t)=>((0,n.uX)(),(0,n.CE)("div",Lt,[l.value.length>0?((0,n.uX)(),(0,n.CE)("div",Tt,[(0,n.Lk)("ul",Ct,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.value,(e=>((0,n.uX)(),(0,n.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,n.Lk)("div",{class:(0,m.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:a.value===e.layerId}]),onClick:t=>o(e.layerId)},[(0,n.Lk)("span",null,[s(e).groupName?((0,n.uX)(),(0,n.CE)("span",Dt,(0,m.v_)(s(e).groupName)+" - ",1)):(0,n.Q3)("",!0),(0,n.Lk)("span",Nt,(0,m.v_)(s(e).layerName),1)])],10,Et),(0,n.Lk)("div",{class:(0,m.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)])))),128))])])):(0,n.Q3)("",!0),l.value.length>0?((0,n.uX)(),(0,n.CE)("div",It,[(0,n.Lk)("div",Mt,[(0,n.Lk)("h5",Rt,(0,m.v_)(i.value),1)]),r.value?((0,n.uX)(),(0,n.CE)("div",Ft,[(0,n.Lk)("div",_t,[t[0]||(t[0]=(0,n.Lk)("h6",{class:"mb-3"},"完整儀表板資料",-1)),(0,n.Lk)("pre",Xt,(0,m.v_)(JSON.stringify(r.value,null,2)),1)])])):((0,n.uX)(),(0,n.CE)("div",St,t[1]||(t[1]=[(0,n.Lk)("div",{class:"my-title-md-gray"},"此圖層沒有可用的儀表板資訊",-1)])))])):((0,n.uX)(),(0,n.CE)("div",Vt,t[2]||(t[2]=[(0,n.Lk)("div",{class:"text-center"},[(0,n.Lk)("div",{class:"my-title-md-gray p-3"},"沒有開啟的圖層")],-1)])))]))}};const $t=jt;var zt=$t,Pt=(a(7588),a(8782));const Ht={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},Wt={key:0,class:""},Kt={class:"nav nav-tabs nav-fill"},Bt=["onClick"],At={key:0,class:"my-title-xs-gray"},Ut={class:"my-title-sm-black"},Ot={key:1,class:"flex-grow-1 d-flex flex-column my-bgcolor-white"},Jt={key:0,class:"flex-grow-1 d-flex flex-column"},Gt={class:"flex-grow-1 d-flex flex-column"},Qt={key:1,class:"flex-grow-1 d-flex align-items-center justify-content-center"},Yt={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var qt={__name:"D3jsTab",props:{containerHeight:{type:Number,default:600},isPanelDragging:{type:Boolean,default:!1},activeMarkers:{type:Array,default:()=>[]}},setup(e,{expose:t}){const a=e,l=R(),o=(0,c.KR)(null),r=(0,c.KR)(null),i=(0,c.KR)({x:10,y:10}),s=(0,c.KR)(null),d=(0,c.KR)(null),u={BACKGROUND:"#212121",GRID_LINE:"#666666",GRID_LINE_SECONDARY:"#333333",NODE_FILL:"#4CAF50",NODE_STROKE:"#2E7D32",TEXT_FILL:"#FFFFFF"},v={red:"#ff0000",lightpink:"#ffb3ba",blue:"#0066cc",green:"#00aa44",lightgreen:"#90ee90",orange:"#ff8800",brown:"#8b4513",yellow:"#ffcc00",purple:"#800080",paleturquoise:"#afeeee",limegreen:"#32cd32"};let g=null;const y=(0,n.EW)((()=>{const e=l.getAllLayers();return e.filter((e=>e.visible))})),p=e=>{console.log("🔄 圖層切換按鈕點擊:",o.value,"->",e),o.value!==e?(Pt.Ltv("#schematic-container").selectAll("svg").remove(),console.log("🗑️ 已清除 SVG 內容"),r.value=null,s.value=null,d.value=null,console.log("🗑️ 已清除數據狀態"),o.value=e,console.log("✅ 已設置新圖層:",e)):console.log("🔄 相同圖層，跳過切換")},h=(0,n.EW)((()=>{if(console.log("currentLayerSummary computed - activeLayerTab:",o.value),console.log("currentLayerSummary computed - visibleLayers:",y.value),!o.value)return console.log("currentLayerSummary - no activeLayerTab, returning null"),null;const e=y.value.find((e=>e.layerId===o.value));console.log("currentLayerSummary - found layer:",e);const t=e&&e.dashboardData||null;return console.log("currentLayerSummary - returning:",t),t})),f=e=>{if(!e)return{groupName:null,layerName:"未知圖層"};const t=l.findGroupNameByLayerId(e.layerId);return{groupName:t,layerName:e.layerName}},b=e=>{if(!e)return!1;const t=l.findLayerById(e);return t&&!0===t.isGridSchematic},x=e=>{console.log("🎲 開始隨機化節點數值，原始節點數量:",e.length);const t=e.map((e=>{const t=Math.floor(5*Math.random())+1;return console.log(`🎲 節點 ${e.coord?.x},${e.coord?.y} 從 ${e.value} 變為 ${t}`),{...e,value:t}}));return console.log("🎲 隨機化完成，前3個節點:",t.slice(0,3)),t},k=async e=>{try{const t=l.findLayerById(e);if(!t)throw new Error(`找不到圖層配置: ${e}`);console.log("🔄 使用圖層配置載入數據:",t.jsonFileName);const a=await t.jsonLoader(t);if(a.processedJsonData)"grid"===a.processedJsonData.type?(r.value=a.processedJsonData,i.value={x:a.processedJsonData.gridX,y:a.processedJsonData.gridY},console.log("✅ 網格數據載入成功:",r.value)):(s.value=a.processedJsonData,console.log("✅ 行政區數據載入成功:",s.value),w());else{if(!(a.dataTableData&&a.dataTableData.length>0))throw new Error("無法從圖層數據中提取示意圖數據");{const e=a.dataTableData.map((e=>({color:e.color,name:e.name,nodes:e.nodes||[]}))),t=e.map((e=>({...e,nodes:x(e.nodes)})));s.value=t,console.log("✅ 表格數據轉換成功:",s.value),w()}}}catch(t){console.error("❌ 無法載入圖層數據:",t.message)}},w=()=>{s.value&&(d.value=[],s.value.forEach((e=>{let t,a,l=[];e.nodes.slice(0,e.nodes.length-1).forEach((e=>{switch(t=e.coord.x,a=e.coord.y,e.type){case 1:case 6:case 21:case 41:t=e.coord.x+.5,a=e.coord.y;break;case 2:case 8:case 12:case 32:t=e.coord.x,a=e.coord.y-.5;break;case 3:case 5:case 23:case 43:t=e.coord.x-.5,a=e.coord.y;break;case 4:case 7:case 14:case 34:t=e.coord.x,a=e.coord.y+.5;break}l.push({value:e.value,type:e.type,coord:{x:t,y:a}})}));let o={color:v[e.color]||e.color,name:e.name,nodes:l};d.value.push(o)})),console.log("linkData",d.value))},L=()=>{const e=document.getElementById("schematic-container");if(e){const t=e.getBoundingClientRect(),a=e.clientWidth||t.width,o=e.clientHeight||t.height;console.log("📏 容器尺寸:",{width:a,height:o,clientWidth:e.clientWidth,clientHeight:e.clientHeight,rectWidth:t.width,rectHeight:t.height});const n={width:Math.max(a,400),height:Math.max(o,300)};return l.updateD3jsDimensions(n.width,n.height),n}const t={width:800,height:600};return l.updateD3jsDimensions(t.width,t.height),t},T=()=>{if(!r.value)return;const e=L(),t={top:20,right:20,bottom:20,left:20},a=e.width-t.left-t.right,l=e.height-t.top-t.bottom,o=Pt.Ltv("#schematic-container").select("svg");if(o.size()>0){const e=parseFloat(o.attr("width")),n=parseFloat(o.attr("height"));if(Math.abs(e-(a+t.left+t.right))<2&&Math.abs(n-(l+t.top+t.bottom))<2)return void console.log("📏 示意圖尺寸變化太小，跳過重繪")}Pt.Ltv("#schematic-container").selectAll("svg").remove();const n=Pt.Ltv("#schematic-container").append("svg").attr("width",a+t.left+t.right).attr("height",l+t.top+t.bottom).style("background-color",u.BACKGROUND).style("transition","all 0.2s ease-in-out"),s=a/i.value.x,c=l/i.value.y;console.log("📊 網格單元格尺寸:",{cellWidth:s,cellHeight:c}),C(n,a,l,s,c,t),E(n,s,c,t)},C=(e,t,a,l,o,n)=>{for(let r=0;r<=i.value.x;r++)e.append("line").style("stroke",u.GRID_LINE).style("stroke-width",1).attr("x1",n.left+r*l).attr("y1",n.top).attr("x2",n.left+r*l).attr("y2",n.top+a);for(let r=0;r<=i.value.y;r++)e.append("line").style("stroke",u.GRID_LINE).style("stroke-width",1).attr("x1",n.left).attr("y1",n.top+r*o).attr("x2",n.left+t).attr("y2",n.top+r*o);for(let r=0;r<i.value.x;r++)e.append("line").style("stroke",u.GRID_LINE_SECONDARY).style("stroke-width",.5).attr("x1",n.left+(r+.5)*l).attr("y1",n.top).attr("x2",n.left+(r+.5)*l).attr("y2",n.top+a);for(let r=0;r<i.value.y;r++)e.append("line").style("stroke",u.GRID_LINE_SECONDARY).style("stroke-width",.5).attr("x1",n.left).attr("y1",n.top+(r+.5)*o).attr("x2",n.left+t).attr("y2",n.top+(r+.5)*o)},E=(e,t,a,l)=>{if(!r.value||!r.value.nodes)return;const o=e.append("g").attr("class","grid-nodes");r.value.nodes.forEach((e=>{const n=l.left+(e.x+.5)*t,r=l.top+(e.y+.5)*a;o.append("circle").attr("cx",n).attr("cy",r).attr("r",.3*Math.min(t,a)).style("fill",u.NODE_FILL).style("stroke",u.NODE_STROKE).style("stroke-width",2).style("opacity",.8).on("mouseover",(function(){Pt.Ltv(this).style("opacity",1).style("stroke-width",3)})).on("mouseout",(function(){Pt.Ltv(this).style("opacity",.8).style("stroke-width",2)})),o.append("text").attr("x",n).attr("y",r).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("font-size",.2*Math.min(t,a)).attr("font-weight","bold").attr("fill",u.TEXT_FILL).text(e.value)}))},D=()=>{if(!s.value)return;let e=L();const t={top:20,right:20,bottom:20,left:20},a=e.width-t.left-t.right,l=e.height-t.top-t.bottom,o=s.value.flatMap((e=>e.nodes.map((e=>({x:e.coord.x,y:e.coord.y})))));console.log("allPoints",o);let n=Pt.T9B(o,(e=>e.x)),r=Pt.T9B(o,(e=>e.y));console.log("Maximum x: ",n),console.log("Maximum y: ",r);const i=Pt.Ltv("#schematic-container").select("svg");if(i.size()>0){const e=parseFloat(i.attr("width")),o=parseFloat(i.attr("height"));if(Math.abs(e-(a+t.left+t.right))<2&&Math.abs(o-(l+t.top+t.bottom))<2)return void console.log("📏 示意圖尺寸變化太小，跳過重繪")}Pt.Ltv("#schematic-container").selectAll("svg").remove();const c=Pt.Ltv("#schematic-container").append("svg").attr("width",a+t.left+t.right).attr("height",l+t.top+t.bottom).style("background-color",u.BACKGROUND).style("transition","all 0.2s ease-in-out"),v=a,g=l,y=Pt.m4Y().domain([0,n]).range([t.left,t.left+v]),m=Pt.m4Y().domain([r,0]).range([t.top,t.top+g]);for(let s=0;s<=n;s++)c.append("line").style("stroke",u.GRID_LINE).attr("x1",y(s)).attr("y1",t.top).attr("x2",y(s)).attr("y2",t.top+g);for(let s=0;s<=r;s++)c.append("line").style("stroke",u.GRID_LINE).attr("x1",t.left).attr("y1",m(s)).attr("x2",t.left+v).attr("y2",m(s));for(let s=0;s<n;s++)c.append("line").style("stroke",u.GRID_LINE_SECONDARY).attr("x1",(y(s)+y(s+1))/2).attr("y1",t.top).attr("x2",(y(s)+y(s+1))/2).attr("y2",t.top+g);for(let s=0;s<r;s++)c.append("line").style("stroke",u.GRID_LINE_SECONDARY).attr("x1",t.left).attr("y1",(m(s)+m(s+1))/2).attr("x2",t.left+v).attr("y2",(m(s)+m(s+1))/2);const p=Pt.n8j().x((e=>y(e.x))).y((e=>m(e.y))).curve(Pt.Xf2);if(s.value.forEach((e=>{e.nodes.forEach((t=>{let a="",l=[];switch(console.log("node.coord.type",t.type),t.type){case 1:l=[{x:t.coord.x-.5,y:t.coord.y},{x:t.coord.x+.5,y:t.coord.y}],a=p(l);break;case 2:l=[{x:t.coord.x,y:t.coord.y-.5},{x:t.coord.x,y:t.coord.y+.5}],a=p(l);break;case 3:l=[{x:t.coord.x+.5,y:t.coord.y},{x:t.coord.x-.5,y:t.coord.y}],a=p(l);break;case 4:l=[{x:t.coord.x,y:t.coord.y+.5},{x:t.coord.x,y:t.coord.y-.5}],a=p(l);break;case 5:l=[{x:t.coord.x,y:t.coord.y},{x:t.coord.x-.5,y:t.coord.y}],a=p(l);break;case 6:l=[{x:t.coord.x+.5,y:t.coord.y},{x:t.coord.x,y:t.coord.y}],a=p(l);break;case 7:l=[{x:t.coord.x,y:t.coord.y+.5},{x:t.coord.x,y:t.coord.y}],a=p(l);break;case 8:l=[{x:t.coord.x,y:t.coord.y},{x:t.coord.x,y:t.coord.y-.5}],a=p(l);break;case 12:case 43:{let o=Math.abs(y(t.coord.x-.5)-y(t.coord.x)),n=Math.abs(m(t.coord.y)-m(t.coord.y-.5)),r=0;o<n?(r=o,l=[{x:t.coord.x,y:m.invert(m(t.coord.y)+r)},{x:t.coord.x,y:t.coord.y-.5}]):(r=n,l=[{x:t.coord.x-.5,y:t.coord.y},{x:y.invert(y(t.coord.x)-r),y:t.coord.y}]),console.log("xWidth yHeight arcWidth",o,n,r),console.log("nodes",l),a=p(l),console.log("dString",a);const i=Pt.JLW().innerRadius(r-3).outerRadius(r+3).startAngle(0).endAngle(Math.PI/2);c.append("path").attr("d",i).attr("transform",`translate(${y(t.coord.x)-r}, ${m(t.coord.y)+r})`).attr("fill",e.color);break}case 21:case 34:{let o=Math.abs(y(t.coord.x-.5)-y(t.coord.x)),n=Math.abs(m(t.coord.y)-m(t.coord.y-.5)),r=0;o<n?(r=o,l=[{x:t.coord.x,y:m.invert(m(t.coord.y)-r)},{x:t.coord.x,y:t.coord.y+.5}]):(r=n,l=[{x:t.coord.x+.5,y:t.coord.y},{x:y.invert(y(t.coord.x)+r),y:t.coord.y}]),console.log("xWidth yHeight arcWidth",o,n,r),console.log("nodes",l),a=p(l),console.log("dString",a);const i=Pt.JLW().innerRadius(r-3).outerRadius(r+3).startAngle(-Math.PI/2).endAngle(-Math.PI);c.append("path").attr("d",i).attr("transform",`translate(${y(t.coord.x)+r}, ${m(t.coord.y)-r})`).attr("fill",e.color);break}case 14:case 23:{let o=Math.abs(y(t.coord.x-.5)-y(t.coord.x)),n=Math.abs(m(t.coord.y)-m(t.coord.y-.5)),r=0;o<n?(r=o,l=[{x:t.coord.x,y:m.invert(m(t.coord.y)-r)},{x:t.coord.x,y:t.coord.y+.5}]):(r=n,l=[{x:t.coord.x-.5,y:t.coord.y},{x:y.invert(y(t.coord.x)-r),y:t.coord.y}]),console.log("xWidth yHeight arcWidth",o,n,r),console.log("nodes",l),a=p(l),console.log("dString",a);const i=Pt.JLW().innerRadius(r-3).outerRadius(r+3).startAngle(Math.PI/2).endAngle(Math.PI);c.append("path").attr("d",i).attr("transform",`translate(${y(t.coord.x)-r}, ${m(t.coord.y)-r})`).attr("fill",e.color);break}case 32:case 41:{let o=Math.abs(y(t.coord.x-.5)-y(t.coord.x)),n=Math.abs(m(t.coord.y)-m(t.coord.y-.5)),r=0;o<n?(r=o,l=[{x:t.coord.x,y:m.invert(m(t.coord.y)+r)},{x:t.coord.x,y:t.coord.y-.5}]):(r=n,l=[{x:t.coord.x+.5,y:t.coord.y},{x:y.invert(y(t.coord.x)+r),y:t.coord.y}]),console.log("xWidth yHeight arcWidth",o,n,r),console.log("nodes",l),a=p(l),console.log("dString",a);const i=Pt.JLW().innerRadius(r-3).outerRadius(r+3).startAngle(0).endAngle(-Math.PI/2);c.append("path").attr("d",i).attr("transform",`translate(${y(t.coord.x)+r}, ${m(t.coord.y)+r})`).attr("fill",e.color);break}default:break}""!==a&&c.append("path").attr("d",a).attr("stroke",e.color).attr("fill","none").attr("stroke-width",6)}))})),d.value){const e=d.value.flatMap((e=>e.nodes.map((e=>({...e})))));console.log("allLinks",e),e.forEach((e=>{c.append("text").attr("x",y(e.coord.x)).attr("y",m(e.coord.y)).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("font-size","10px").attr("fill","white").text(`${e.value}`)}))}},N=()=>{b(o.value)?T():D()},I=()=>{console.log("📏 D3jsTab: 觸發 resize，重新繪製示意圖"),L(),N()},M=(0,c.KR)([]);return(0,n.wB)((()=>y.value),(e=>{if(0===e.length)return o.value=null,void(M.value=[]);const t=M.value.map((e=>e.layerId)),a=e.map((e=>e.layerId)),l=a.filter((e=>!t.includes(e)));if(l.length>0){const e=l[l.length-1];o.value=e}else o.value&&e.find((e=>e.layerId===o.value))||(o.value=e[0].layerId);M.value=[...e]}),{deep:!0,immediate:!0}),(0,n.wB)((()=>o.value),(async(e,t)=>{e&&e!==t&&(console.log("🔄 監聽器觸發圖層切換:",t,"->",e),Pt.Ltv("#schematic-container").selectAll("svg").remove(),console.log("🗑️ 監聽器：已清除 SVG 內容"),r.value=null,s.value=null,d.value=null,console.log("🗑️ 監聽器：已清除數據狀態"),console.log("📊 開始載入新圖層數據:",e),await k(e),await(0,n.dY)(),console.log("🎨 開始繪製新圖層示意圖"),N(),console.log("✅ 圖層切換完成"))})),(0,n.wB)((()=>a.containerHeight),(()=>{(0,n.dY)((()=>{I()}))})),(0,n.sV)((async()=>{console.log("D3jsTab mounted - visibleLayers:",y.value),console.log("D3jsTab mounted - activeLayerTab:",o.value),y.value.length>0&&!o.value&&(o.value=y.value[0].layerId,console.log("D3jsTab - Set initial activeLayerTab to:",o.value),await k(o.value),await(0,n.dY)(),N()),window.addEventListener("resize",I);const e=document.getElementById("schematic-container");if(e&&window.ResizeObserver){g=new ResizeObserver((e=>{for(let t of e){const{width:e,height:a}=t.contentRect;e>0&&a>0&&I()}})),g.observe(e);const t=e.parentElement;t&&g.observe(t)}})),(0,n.hi)((()=>{window.removeEventListener("resize",I),g&&(g.disconnect(),g=null)})),t({resize:I}),(e,t)=>((0,n.uX)(),(0,n.CE)("div",Ht,[y.value.length>0?((0,n.uX)(),(0,n.CE)("div",Wt,[(0,n.Lk)("ul",Kt,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(y.value,(e=>((0,n.uX)(),(0,n.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,n.Lk)("div",{class:(0,m.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:o.value===e.layerId}]),onClick:t=>p(e.layerId)},[(0,n.Lk)("span",null,[f(e).groupName?((0,n.uX)(),(0,n.CE)("span",At,(0,m.v_)(f(e).groupName)+" - ",1)):(0,n.Q3)("",!0),(0,n.Lk)("span",Ut,(0,m.v_)(f(e).layerName),1)])],10,Bt),(0,n.Lk)("div",{class:(0,m.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)])))),128))])])):(0,n.Q3)("",!0),y.value.length>0?((0,n.uX)(),(0,n.CE)("div",Ot,[h.value?((0,n.uX)(),(0,n.CE)("div",Jt,[(0,n.Lk)("div",Gt,[(0,n.Lk)("div",{class:"flex-grow-1",style:(0,m.Tr)({height:Math.max(a.containerHeight-100,300)+"px",minHeight:"300px"})},t[0]||(t[0]=[(0,n.Lk)("div",{id:"schematic-container",class:"w-100 h-100",style:{"min-height":"300px",overflow:"hidden"}},null,-1)]),4)])])):((0,n.uX)(),(0,n.CE)("div",Qt,t[1]||(t[1]=[(0,n.Lk)("div",{class:"text-center"},[(0,n.Lk)("div",{class:"my-title-md-gray"},"此圖層沒有可用的摘要資訊")],-1)])))])):((0,n.uX)(),(0,n.CE)("div",Yt,t[2]||(t[2]=[(0,n.Lk)("div",{class:"text-center"},[(0,n.Lk)("div",{class:"my-title-md-gray p-3"},"沒有開啟的圖層")],-1)])))]))}};const Zt=(0,u.A)(qt,[["__scopeId","data-v-9ebc9f04"]]);var ea=Zt;const ta={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},aa={key:0,class:""},la={class:"nav nav-tabs nav-fill"},oa=["onClick"],na={key:0,class:"my-title-xs-gray"},ra={class:"my-title-sm-black"},ia={key:1,class:"flex-grow-1 overflow-auto my-bgcolor-white p-3"},sa={class:"mb-4"},ca={class:"my-title-md-black"},da={class:"rounded-4 my-bgcolor-gray-100 p-4 mb-3"},ua={class:"my-font-size-sm",style:{"white-space":"pre-wrap","word-wrap":"break-word","max-height":"500px","overflow-y":"auto"}},va={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var ga={__name:"processedJsonDataTab",setup(e){const t=R(),a=(0,c.KR)(null),l=(0,n.EW)((()=>{const e=t.getAllLayers();return e.filter((e=>e.visible))})),o=e=>{a.value=e},r=(0,n.EW)((()=>{if(!a.value)return"無開啟圖層";const e=l.value.find((e=>e.layerId===a.value));return e?e.layerName||"未知圖層":"無開啟圖層"})),i=e=>{if(!e)return{groupName:null,layerName:"未知圖層"};const a=t.findGroupNameByLayerId(e.layerId);return{groupName:a,layerName:e.layerName}},s=()=>{if(!a.value)return null;const e=l.value.find((e=>e.layerId===a.value));return e&&e.processedJsonData||null},d=(0,c.KR)([]);return(0,n.wB)((()=>l.value),(e=>{if(0===e.length)return a.value=null,void(d.value=[]);const t=d.value.map((e=>e.layerId)),l=e.map((e=>e.layerId)),o=l.filter((e=>!t.includes(e)));if(o.length>0){const t=o[o.length-1];a.value=t,console.log(`🔄 自動切換到新開啟的圖層: ${e.find((e=>e.layerId===t))?.layerName}`)}else a.value&&e.find((e=>e.layerId===a.value))||(a.value=e[0].layerId);d.value=[...e]}),{deep:!0,immediate:!0}),(0,n.sV)((()=>{console.log("[ProcessedJsonDataTab] Component Mounted"),l.value.length>0&&!a.value&&(a.value=l.value[0].layerId)})),(e,t)=>((0,n.uX)(),(0,n.CE)("div",ta,[l.value.length>0?((0,n.uX)(),(0,n.CE)("div",aa,[(0,n.Lk)("ul",la,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.value,(e=>((0,n.uX)(),(0,n.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,n.Lk)("div",{class:(0,m.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:a.value===e.layerId}]),onClick:t=>o(e.layerId)},[(0,n.Lk)("span",null,[i(e).groupName?((0,n.uX)(),(0,n.CE)("span",na,(0,m.v_)(i(e).groupName)+" - ",1)):(0,n.Q3)("",!0),(0,n.Lk)("span",ra,(0,m.v_)(i(e).layerName),1)])],10,oa),(0,n.Lk)("div",{class:(0,m.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)])))),128))])])):(0,n.Q3)("",!0),l.value.length>0?((0,n.uX)(),(0,n.CE)("div",ia,[(0,n.Lk)("div",sa,[(0,n.Lk)("h5",ca,(0,m.v_)(r.value),1)]),(0,n.Lk)("div",da,[t[0]||(t[0]=(0,n.Lk)("h6",{class:"mb-3"},"處理後 JSON 數據",-1)),(0,n.Lk)("pre",ua,(0,m.v_)(JSON.stringify(s(),null,2)),1)])])):((0,n.uX)(),(0,n.CE)("div",va,t[1]||(t[1]=[(0,n.Lk)("div",{class:"text-center"},[(0,n.Lk)("div",{class:"my-title-md-gray p-3"},"沒有開啟的圖層")],-1)])))]))}};const ya=ga;var ma=ya;const pa={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},ha={key:0,class:""},fa={class:"nav nav-tabs nav-fill"},ba=["onClick"],xa={key:0,class:"my-title-xs-gray"},ka={class:"my-title-sm-black"},wa={key:1,class:"flex-grow-1 overflow-auto my-bgcolor-white p-3"},La={class:"mb-4"},Ta={class:"my-title-md-black"},Ca={key:0},Ea={class:"rounded-4 my-bgcolor-gray-100 p-4 mb-3"},Da={class:"my-font-size-sm",style:{"white-space":"pre-wrap","word-wrap":"break-word","max-height":"500px","overflow-y":"auto"}},Na={key:1,class:"text-center py-5"},Ia={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var Ma={__name:"jsonDataTab",setup(e){const t=R(),a=(0,c.KR)(null),l=(0,n.EW)((()=>{const e=t.getAllLayers();return e.filter((e=>e.visible))})),o=e=>{a.value=e},r=(0,n.EW)((()=>{if(!a.value)return"無開啟圖層";const e=l.value.find((e=>e.layerId===a.value));return e?e.layerName||"未知圖層":"無開啟圖層"})),i=e=>{if(!e)return{groupName:null,layerName:"未知圖層"};const a=t.findGroupNameByLayerId(e.layerId);return{groupName:a,layerName:e.layerName}},s=()=>{if(!a.value)return null;const e=l.value.find((e=>e.layerId===a.value));return e&&e.jsonData||null},d=(0,c.KR)([]);return(0,n.wB)((()=>l.value),(e=>{if(0===e.length)return a.value=null,void(d.value=[]);const t=d.value.map((e=>e.layerId)),l=e.map((e=>e.layerId)),o=l.filter((e=>!t.includes(e)));if(o.length>0){const t=o[o.length-1];a.value=t,console.log(`🔄 自動切換到新開啟的圖層: ${e.find((e=>e.layerId===t))?.layerName}`)}else a.value&&e.find((e=>e.layerId===a.value))||(a.value=e[0].layerId);d.value=[...e]}),{deep:!0,immediate:!0}),(0,n.sV)((()=>{console.log("[JsonDataTab] Component Mounted"),l.value.length>0&&!a.value&&(a.value=l.value[0].layerId)})),(e,t)=>((0,n.uX)(),(0,n.CE)("div",pa,[l.value.length>0?((0,n.uX)(),(0,n.CE)("div",ha,[(0,n.Lk)("ul",fa,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(l.value,(e=>((0,n.uX)(),(0,n.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,n.Lk)("div",{class:(0,m.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:a.value===e.layerId}]),onClick:t=>o(e.layerId)},[(0,n.Lk)("span",null,[i(e).groupName?((0,n.uX)(),(0,n.CE)("span",xa,(0,m.v_)(i(e).groupName)+" - ",1)):(0,n.Q3)("",!0),(0,n.Lk)("span",ka,(0,m.v_)(i(e).layerName),1)])],10,ba),(0,n.Lk)("div",{class:(0,m.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)])))),128))])])):(0,n.Q3)("",!0),l.value.length>0?((0,n.uX)(),(0,n.CE)("div",wa,[(0,n.Lk)("div",La,[(0,n.Lk)("h5",Ta,(0,m.v_)(r.value),1)]),s()?((0,n.uX)(),(0,n.CE)("div",Ca,[(0,n.Lk)("div",Ea,[t[0]||(t[0]=(0,n.Lk)("h6",{class:"mb-3"},"原始 JSON 數據",-1)),(0,n.Lk)("pre",Da,(0,m.v_)(JSON.stringify(s(),null,2)),1)])])):((0,n.uX)(),(0,n.CE)("div",Na,t[1]||(t[1]=[(0,n.Lk)("div",{class:"my-title-md-gray"},"此圖層沒有可用的原始 JSON 數據",-1)])))])):((0,n.uX)(),(0,n.CE)("div",Ia,t[2]||(t[2]=[(0,n.Lk)("div",{class:"text-center"},[(0,n.Lk)("div",{class:"my-title-md-gray p-3"},"沒有開啟的圖層")],-1)])))]))}};const Ra=Ma;var Fa=Ra,_a={name:"UpperView",components:{DashboardTab:zt,D3jsTab:ea,ProcessedJsonDataTab:ma,JsonDataTab:Fa},props:{activeUpperTab:{type:String,default:"d3js"},mainPanelWidth:{type:Number,default:60},contentHeight:{type:Number,default:500},selectedFilter:{type:String,default:""},zoomLevel:{type:Number,default:11},isPanelDragging:{type:Boolean,default:!1},activeMarkers:{type:Number,default:0}},emits:["update:activeUpperTab","update:zoomLevel","update:currentCoords","update:activeMarkers","feature-selected"],setup(e){const t=(0,c.KR)(null),a=(0,c.KR)(null),l=(0,c.KR)(null),o=(0,c.KR)(null),r=(0,c.KR)(null),i=(0,c.KR)(null),s=(0,c.KR)(null),d=(0,c.KR)(null);(0,n.wB)([()=>e.isPanelDragging,()=>e.activeUpperTab],(([e,t])=>{(0,n.dY)((()=>{a.value&&(e&&"dashboard"===t?(a.value.style.pointerEvents="none",console.log("MainContent: Dashboard container pointer-events set to none")):(a.value.style.pointerEvents="auto",console.log("MainContent: Dashboard container pointer-events set to auto (dragging:",e,", tab:",t,")"))),o.value&&(e&&"d3js"===t?(o.value.style.pointerEvents="none",console.log("MainContent: D3.js container pointer-events set to none")):(o.value.style.pointerEvents="auto",console.log("MainContent: D3.js container pointer-events set to auto (dragging:",e,", tab:",t,")"))),i.value&&(e&&"processed-json-data"===t?(i.value.style.pointerEvents="none",console.log("MainContent: ProcessedJsonData container pointer-events set to none")):(i.value.style.pointerEvents="auto",console.log("MainContent: ProcessedJsonData container pointer-events set to auto (dragging:",e,", tab:",t,")"))),d.value&&(e&&"json-data"===t?(d.value.style.pointerEvents="none",console.log("MainContent: JsonData container pointer-events set to none")):(d.value.style.pointerEvents="auto",console.log("MainContent: JsonData container pointer-events set to auto (dragging:",e,", tab:",t,")")))}))}),{immediate:!0}),(0,n.wB)((()=>e.activeUpperTab),((e,t)=>{console.log("🔄 UpperView: Tab changed from",t,"to",e)})),(0,n.wB)([()=>e.mainPanelWidth,()=>e.contentHeight],(()=>{(0,n.dY)((()=>{l.value&&l.value.resize&&l.value.resize()}))}));const u=e=>{console.log("🎯 UpperView: highlightFeature called with data:",e),console.log("🎯 highlightFeature: 地圖功能已移除，無需高亮顯示")},v=()=>{console.log("🔄 resetView: 地圖功能已移除，無需重設視圖")},g=()=>{console.log("🗺️ fitToTainanBounds: 地圖功能已移除，無需適應邊界")},y=()=>{console.log("🔄 invalidateMapSize: 觸發 D3jsTab 重新繪製"),l.value&&l.value.resize&&l.value.resize()};return{DashboardTab:t,D3jsTab:l,ProcessedJsonDataTab:r,JsonDataTab:s,dashboardContainerRef:a,d3jsContainerRef:o,processedJsonDataContainerRef:i,jsonDataContainerRef:d,highlightFeature:u,resetView:v,fitToTainanBounds:g,invalidateMapSize:y,getIcon:Pe}}};const Xa=(0,u.A)(_a,[["render",wt]]);var Sa=Xa;const Va={ref:"bottomTabContentRef",class:"flex-grow-1 h-100 overflow-auto"},ja={class:"h-100"};function $a(e,t,a,l,o,r){const i=(0,n.g2)("DataTableTab");return(0,n.uX)(),(0,n.CE)("div",{class:"d-flex flex-column",style:(0,m.Tr)({height:a.bottomViewHeight+"px"})},[(0,n.Lk)("div",Va,[(0,n.Lk)("div",ja,[(0,n.bF)(i,{onHighlightOnMap:t[0]||(t[0]=t=>e.$emit("highlight-on-map",t)),onFeatureSelected:t[1]||(t[1]=t=>e.$emit("feature-selected",t))})])],512)],4)}a(7642),a(8004),a(3853),a(5876),a(2475),a(5024),a(1698);const za={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},Pa={key:0,class:""},Ha={class:"nav nav-tabs nav-fill"},Wa=["onClick"],Ka={class:"my-title-sm-black"},Ba={key:0,class:"my-title-xs-gray"},Aa={key:1,class:"my-content-xs-gray ms-2"},Ua={key:1,class:"flex-grow-1 overflow-hidden"},Oa={class:"h-100 d-flex flex-column"},Ja={class:"flex-grow-1 overflow-auto"},Ga={class:"table w-100 mb-0"},Qa={class:"sticky-top my-table-thead"},Ya={class:"text-center text-nowrap"},qa=["onClick"],Za={class:"my-title-xs-gray text-nowrap"},el={class:"my-title-xs-gray text-nowrap ms-2"},tl=["onClick"],al={key:0,class:"border-0 text-nowrap text-truncate p-0",style:{"max-width":"80px"}},ll={key:0,class:"d-flex align-items-center justify-content-center px-3 py-2"},ol=["title"],nl={class:"my-content-xs-black"},rl={key:1,class:"my-content-xs-black px-3 py-2"},il={key:2,class:"my-content-xs-black px-3 py-2"},sl={key:3,class:"d-flex p-0"},cl={class:"my-content-xs-black w-100 px-3 py-2"},dl={key:4,class:"d-flex align-items-center justify-content-center px-3 py-2"},ul=["title"],vl={class:"my-content-xs-black"},gl={key:5,class:"d-flex align-items-center justify-content-center px-3 py-2"},yl=["title"],ml={class:"my-content-xs-black"},pl={key:6,class:"d-flex align-items-center justify-content-center px-3 py-2"},hl=["title"],fl={class:"my-content-xs-black"},bl={key:7,class:"d-flex align-items-center justify-content-center px-3 py-2"},xl=["title"],kl={class:"my-content-xs-black"},wl={key:8,class:"my-content-xs-black px-3 py-2"},Ll={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var Tl={__name:"DataTableTab",emits:["highlight-on-map","feature-selected"],setup(e,{emit:t}){const a=t,o=R(),r=(0,c.KR)(null),i=(0,c.KR)({}),s=(0,n.EW)((()=>{const e=o.getAllLayers();return e.filter((e=>e.visible))})),d=e=>{r.value=e},u=e=>{if(!e)return{groupName:null,layerName:"未知圖層"};const t=o.findGroupNameByLayerId(e.layerId);return{groupName:t,layerName:e.layerName}},v=e=>{const t=e.dataTableData;if(!t||0===t.length)return[];const a=new Set;return t.forEach((e=>{Object.keys(e).forEach((t=>{const l=e[t];"color"===t||"name"===t||"nodes"===t?a.add(t):"object"===typeof l&&null!==l||a.add(t)}))})),Array.from(a)},g=e=>{const t=e.dataTableData?.length||0;return console.log("DataTable - Layer data count:",{layerId:e.layerId,layerName:e.layerName,hasTableData:!!e.dataTableData,dataCount:t,sampleData:e.dataTableData?.[0]||null}),t},y=e=>{if(!e.dataTableData)return[];const t=i.value[e.layerId];return t&&t.key?[...e.dataTableData].sort(((e,a)=>{const l=e[t.key],o=a[t.key],n=["count","spatial_lag","#","P_CNT","感染率(%)"];if(n.includes(t.key)){const e=parseFloat(l)||0,a=parseFloat(o)||0;return"asc"===t.order?e-a:a-e}return"string"===typeof l&&"string"===typeof o?"asc"===t.order?l.localeCompare(o):o.localeCompare(l):"asc"===t.order?l-o:o-l})):e.dataTableData},p=(e,t)=>{i.value[e]||(i.value[e]={key:null,order:"asc"});const a=i.value[e];a.key===t?a.order="asc"===a.order?"desc":"asc":(a.key=t,a.order="asc")},h=(e,t)=>{const a=i.value[e];return a&&a.key===t?"asc"===a.order?Pe("sort_up").icon:Pe("sort_down").icon:Pe("sort").icon},f=(e,t)=>{console.log("點擊項目:",{item:e,layer:t.layerName});const l={properties:{id:e["#"]||e.id||"unknown",layerId:t.layerId,propertyData:{...e},itemColor:e.color||"#6c757d"}};console.log("設置 selectedFeature:",l),o.setSelectedFeature(l),a("feature-selected",l)},b=(0,c.KR)([]);return(0,n.wB)((()=>s.value),(e=>{if(0===e.length)return r.value=null,void(b.value=[]);const t=b.value.map((e=>e.layerId)),a=e.map((e=>e.layerId)),l=a.filter((e=>!t.includes(e)));if(l.length>0){const t=l[l.length-1];r.value=t,console.log(`🔄 自動切換到新開啟的圖層: ${e.find((e=>e.layerId===t))?.layerName}`)}else r.value&&e.find((e=>e.layerId===r.value))||(r.value=e[0].layerId);b.value=[...e]}),{deep:!0,immediate:!0}),(0,n.sV)((()=>{console.log("[DataTableTab] Component Mounted"),s.value.length>0&&!r.value&&(r.value=s.value[0].layerId)})),(e,t)=>((0,n.uX)(),(0,n.CE)("div",za,[s.value.length>0?((0,n.uX)(),(0,n.CE)("div",Pa,[(0,n.Lk)("ul",Ha,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.value,(e=>((0,n.uX)(),(0,n.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,n.Lk)("div",{class:(0,m.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:r.value===e.layerId}]),onClick:t=>d(e.layerId)},[(0,n.Lk)("span",Ka,[u(e).groupName?((0,n.uX)(),(0,n.CE)("span",Ba,(0,m.v_)(u(e).groupName)+" - ",1)):(0,n.Q3)("",!0),(0,n.Lk)("span",null,(0,m.v_)(u(e).layerName),1),g(e)?((0,n.uX)(),(0,n.CE)("span",Aa,(0,m.v_)(g(e)),1)):(0,n.Q3)("",!0)])],10,Wa),(0,n.Lk)("div",{class:(0,m.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)])))),128))])])):(0,n.Q3)("",!0),s.value.length>0?((0,n.uX)(),(0,n.CE)("div",Ua,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(s.value,(e=>(0,n.bo)(((0,n.uX)(),(0,n.CE)("div",{key:e.layerId,class:"h-100"},[(0,n.Lk)("div",Oa,[(0,n.Lk)("div",Ja,[(0,n.Lk)("table",Ga,[(0,n.Lk)("thead",Qa,[(0,n.Lk)("tr",Ya,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(v(e),(t=>((0,n.uX)(),(0,n.CE)(n.FK,{key:t},[t.endsWith("_color")?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("th",{key:0,onClick:a=>p(e.layerId,t),class:"my-bgcolor-white-hover p-1 my-cursor-pointer"},[(0,n.Lk)("span",Za,(0,m.v_)("nodes"===t?"節點數":t),1),(0,n.Lk)("span",el,[(0,n.Lk)("i",{class:(0,m.C4)(h(e.layerId,t))},null,2)])],8,qa))],64)))),128))])]),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(y(e),(t=>((0,n.uX)(),(0,n.CE)("tr",{key:t.id,class:"my-table-tr-hover text-center text-nowrap border-bottom my-cursor-pointer",onClick:a=>f(t,e)},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(v(e),(e=>((0,n.uX)(),(0,n.CE)(n.FK,{key:e},[e.endsWith("_color")?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.CE)("td",al,["color"===e?((0,n.uX)(),(0,n.CE)("div",ll,[(0,n.Lk)("div",{class:"rounded-circle me-2",style:(0,m.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:t[e]}]),title:t[e]},null,12,ol),(0,n.Lk)("div",nl,(0,m.v_)(t[e]||"-"),1)])):"nodes"===e?((0,n.uX)(),(0,n.CE)("div",rl,(0,m.v_)(Array.isArray(t[e])?t[e].length:"-"),1)):"name"===e?((0,n.uX)(),(0,n.CE)("div",il,(0,m.v_)(t[e]||"-"),1)):"#"===e?((0,n.uX)(),(0,n.CE)("div",sl,[(0,n.Lk)("div",{style:(0,m.Tr)([{"min-width":"6px"},{backgroundColor:t["color"]}])},null,4),(0,n.Lk)("div",cl,(0,m.v_)(t[e]||"-"),1)])):"spatial_lag"===e?((0,n.uX)(),(0,n.CE)("div",dl,[t["spatial_lag_color"]?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,m.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:t["spatial_lag_color"]}]),title:t["spatial_lag_color"]},null,12,ul)):(0,n.Q3)("",!0),(0,n.Lk)("div",vl,(0,m.v_)("number"===typeof t[e]?t[e].toFixed(2):t[e]||"-"),1)])):"binaryValue"===e?((0,n.uX)(),(0,n.CE)("div",gl,[t["joinCounts_color"]?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,m.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:t["joinCounts_color"]}]),title:t["joinCounts_color"]},null,12,yl)):(0,n.Q3)("",!0),(0,n.Lk)("div",ml,(0,m.v_)(t[e]),1)])):"count"===e?((0,n.uX)(),(0,n.CE)("div",pl,[t["color"]?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,m.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:t["color"]}]),title:t["color"]},null,12,hl)):(0,n.Q3)("",!0),(0,n.Lk)("div",fl,(0,m.v_)(t[e]),1)])):"感染率(%)"===e?((0,n.uX)(),(0,n.CE)("div",bl,[t["infection_rate_color"]?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,m.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:t["infection_rate_color"]}]),title:t["infection_rate_color"]},null,12,xl)):(0,n.Q3)("",!0),(0,n.Lk)("div",kl,(0,m.v_)(t[e]||"-"),1)])):((0,n.uX)(),(0,n.CE)("div",wl,(0,m.v_)(t[e]||"-"),1))]))],64)))),128))],8,tl)))),128))])])])])])),[[l.aG,r.value===e.layerId]]))),128))])):((0,n.uX)(),(0,n.CE)("div",Ll,t[0]||(t[0]=[(0,n.Lk)("div",{class:"text-center"},[(0,n.Lk)("div",{class:"my-title-md-gray p-3"},"沒有開啟的圖層")],-1)])))]))}};const Cl=(0,u.A)(Tl,[["__scopeId","data-v-59b326e6"]]);var El=Cl,Dl={name:"BottomView",components:{DataTableTab:El},props:{activeBottomTab:{type:String,default:"table"},bottomViewHeight:{type:Number,default:300},isPanelDragging:{type:Boolean,default:!1}},emits:["update:activeBottomTab","highlight-on-map","feature-selected","reset-view"],setup(e){const t=(0,c.KR)(null);return(0,n.wB)((()=>e.activeBottomTab),(()=>{(0,n.dY)((()=>{console.log(`✅ 底部分頁已切換至: ${e.activeBottomTab}`)}))})),{bottomTabContentRef:t}}};const Nl=(0,u.A)(Dl,[["render",$a]]);var Il=Nl;const Ml={class:"d-flex flex-column overflow-hidden h-100"};var Rl={__name:"MiddleView",props:{activeUpperTab:{type:String,default:"d3js"},activeBottomTab:{type:String,default:"table"},mainPanelWidth:{type:Number,default:60},dynamicMainAreaHeight:{type:Number,default:500},selectedFilter:{type:String,default:""},zoomLevel:{type:Number,default:11},currentCoords:{type:Object,default:()=>({lat:25.033,lng:121.5654})},activeMarkers:{type:Number,default:0},isSidePanelDragging:{type:Boolean,default:!1}},emits:["update:activeUpperTab","update:activeBottomTab","update:zoomLevel","update:currentCoords","update:activeMarkers","update:tableSearchQuery","sort-table","highlight-on-map","feature-selected","reset-view"],setup(e,{expose:t}){const a=e,l=(0,c.KR)(null),o=(0,c.KR)(30),r=(0,c.KR)(!1),i=(0,n.EW)((()=>a.isSidePanelDragging||r.value)),s=(0,n.EW)((()=>{const e=a.dynamicMainAreaHeight;return console.log(`🔧 MiddleView: middleSectionTotalHeight (from prop): ${e}`),Math.max(e,0)})),d=(0,n.EW)((()=>{const e=o.value/100*s.value;return console.log(`🔧 MiddleView: actualBottomViewPixelHeight calculated: ${e} (percent: ${o.value}%, totalMiddle: ${s.value})`),e})),u=(0,n.EW)((()=>{const e=s.value-d.value;return console.log(`🔧 MiddleView: contentHeight (for MainContent) calculated: ${e}, totalMiddle: ${s.value}, bottomViewPx: ${d.value}`),e})),v=e=>{e.preventDefault(),e.stopPropagation(),r.value=!0,document.body.classList.add("my-no-select");const t=e.clientY,a=o.value,l=s.value,n=e=>{e.preventDefault();const n=e.clientY-t;if(0===l)return;const r=n/l*100;let i=a-r;i=Math.max(0,Math.min(100,i)),o.value=Math.round(10*i)/10},i=()=>{r.value=!1,document.body.classList.remove("my-no-select"),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",i)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",i)};(0,n.wB)((()=>a.activeUpperTab),((e,t)=>{console.log(`🔧 MiddleView Watcher: activeUpperTab changed from "${t}" to "${e}". Current bottomViewHeightPercent: ${o.value}%`)})),(0,n.sV)((()=>{console.log("🚀 MiddleView mounted")})),(0,n.hi)((()=>{console.log("🗑️ MiddleView unmounted")}));const g=e=>{l.value?(console.log("🎯 MiddleView: 呼叫 highlightFeature",e),l.value.highlightFeature(e)):console.warn("⚠️ 無法高亮顯示：mainContentRef 未定義")},y=()=>{l.value&&(console.log("🗺️ MiddleView: 呼叫 fitToTainanBounds"),l.value.fitToTainanBounds())},p=()=>{console.log("🔄 MiddleView: MapTab已移除，resetMapTab功能已停用")},h=()=>{l.value&&(console.log("📏 MiddleView: 呼叫地圖尺寸刷新"),l.value.invalidateMapSize())},f=()=>{l.value&&(console.log("🛑 MiddleView: 停止地圖點擊模式"),l.value.stopMapClickMode())};return t({highlightFeature:g,fitToTainanBounds:y,resetMapTab:p,invalidateMapSize:h,stopMapClickMode:f}),(t,a)=>((0,n.uX)(),(0,n.CE)("div",Ml,[(0,n.Lk)("div",{style:(0,m.Tr)({pointerEvents:i.value?"none":"auto",height:u.value+"px",overflow:"hidden"})},[(0,n.bF)(Sa,{ref_key:"mainContentRef",ref:l,activeUpperTab:e.activeUpperTab,mainPanelWidth:e.mainPanelWidth,contentHeight:u.value,selectedFilter:e.selectedFilter,zoomLevel:e.zoomLevel,isPanelDragging:i.value,activeMarkers:e.activeMarkers,"onUpdate:activeUpperTab":a[0]||(a[0]=e=>t.$emit("update:activeUpperTab",e)),"onUpdate:zoomLevel":a[1]||(a[1]=e=>t.$emit("update:zoomLevel",e)),"onUpdate:currentCoords":a[2]||(a[2]=e=>t.$emit("update:currentCoords",e)),"onUpdate:activeMarkers":a[3]||(a[3]=e=>t.$emit("update:activeMarkers",e)),onFeatureSelected:a[4]||(a[4]=e=>t.$emit("feature-selected",e))},null,8,["activeUpperTab","mainPanelWidth","contentHeight","selectedFilter","zoomLevel","isPanelDragging","activeMarkers"])],4),(0,n.Lk)("div",{class:(0,m.C4)(["my-resizer my-resizer-horizontal my-resizer-middle",{"my-dragging":r.value}]),onMousedown:v,title:"拖曳調整底部面板高度"},null,34),(0,n.Lk)("div",{class:"overflow-hidden",style:(0,m.Tr)({pointerEvents:i.value?"none":"auto",height:d.value+"px"})},[(0,n.bF)(Il,{activeBottomTab:e.activeBottomTab,bottomViewHeight:d.value,isPanelDragging:i.value,"onUpdate:activeBottomTab":a[5]||(a[5]=e=>t.$emit("update:activeBottomTab",e)),onHighlightOnMap:a[6]||(a[6]=e=>t.$emit("highlight-on-map",e)),onFeatureSelected:a[7]||(a[7]=e=>t.$emit("feature-selected",e)),onResetView:a[8]||(a[8]=e=>t.$emit("reset-view"))},null,8,["activeBottomTab","bottomViewHeight","isPanelDragging"])],4)]))}};const Fl=Rl;var _l=Fl;const Xl={class:"d-flex flex-column h-100 my-bgcolor-gray-200"},Sl={class:"flex-grow-1 overflow-hidden",style:{"padding-bottom":"70px"}},Vl={class:"h-100"},jl={class:"h-100"},$l={class:"h-100"},zl={class:"h-100"},Pl=["onClick"],Hl={class:"d-flex flex-column align-items-center justify-content-center w-100"},Wl={class:"my-font-size-sm"},Kl={class:"my-font-size-xs"};function Bl(e,t,a,o,r,i){const s=(0,n.g2)("LayersTab"),c=(0,n.g2)("DataTableTab"),d=(0,n.g2)("PropertiesTab"),u=(0,n.g2)("LayerInfo");return(0,n.uX)(),(0,n.CE)("div",Xl,[(0,n.Lk)("div",Sl,[(0,n.bo)((0,n.Lk)("div",Vl,[(0,n.bF)(s)],512),[[l.aG,"layers"===a.activeTab]]),(0,n.bo)((0,n.Lk)("div",jl,[(0,n.bF)(c,{onHighlightOnMap:t[0]||(t[0]=t=>e.$emit("highlight-on-map",t)),onFeatureSelected:t[1]||(t[1]=t=>e.$emit("feature-selected",t))})],512),[[l.aG,"table"===a.activeTab]]),(0,n.bo)((0,n.Lk)("div",$l,[(0,n.bF)(d,{onHighlightFeature:t[2]||(t[2]=t=>e.$emit("highlight-feature",t))})],512),[[l.aG,"properties"===a.activeTab]]),(0,n.bo)((0,n.Lk)("div",zl,[(0,n.bF)(u)],512),[[l.aG,"layer-info"===a.activeTab]])]),(0,n.Lk)("div",{class:"position-fixed bottom-0 start-0 end-0 d-flex align-items-center justify-content-between my-bgcolor-gray-200 border-top z-100 w-100",style:(0,m.Tr)(o.getBottomNavStyle)},[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.availableTabs,(e=>((0,n.uX)(),(0,n.CE)("button",{key:e.id,class:(0,m.C4)(["d-flex rounded-3 border-0 flex-grow-1 py-2 mx-1",{"my-btn-transparent":a.activeTab!==e.id,"my-btn-blue":a.activeTab===e.id}]),style:{"min-height":"44px","touch-action":"manipulation","-webkit-appearance":"none !important"},onClick:t=>o.switchTab(e.id)},[(0,n.Lk)("div",Hl,[(0,n.Lk)("span",Wl,[(0,n.Lk)("i",{class:(0,m.C4)([e.icon,"mb-1"])},null,2)]),(0,n.Lk)("span",Kl,(0,m.v_)(e.name),1)])],10,Pl)))),128))],4)])}var Al={name:"ResponsiveLowerView",components:{LayersTab:ce,DataTableTab:El,PropertiesTab:$e,LayerInfo:dt},props:{activeTab:{type:String,default:"layers"},activeRightTab:{type:String,default:"layer-info"},activeBottomTab:{type:String,default:"table"}},emits:["update:activeTab","update:activeRightTab","update:activeBottomTab","highlight-on-map","highlight-feature","feature-selected"],setup(e,{emit:t}){const a=(0,c.KR)(0),l=(0,n.EW)((()=>[{id:"layers",name:"圖層",icon:Pe("layer_group").icon},{id:"table",name:"資料表",icon:Pe("table").icon},{id:"properties",name:"屬性",icon:Pe("location_dot").icon},{id:"layer-info",name:"圖層資訊",icon:Pe("info_circle").icon}])),o=()=>{const e=window.innerHeight,t=window.visualViewport?.height||e,l=e-t;a.value=l>0?l:0},r=(0,n.EW)((()=>{const e=60,t=a.value>0?a.value+10:10;return{"min-height":`${e}px`,height:`${e+t}px`,padding:`8px 4px ${t}px 4px`}})),i=e=>{t("update:activeTab",e)};return(0,n.sV)((()=>{o(),window.addEventListener("resize",o),window.visualViewport&&(window.visualViewport.addEventListener("resize",o),window.visualViewport.addEventListener("scroll",o)),window.addEventListener("orientationchange",(()=>{setTimeout(o,300)}))})),(0,n.hi)((()=>{window.removeEventListener("resize",o),window.visualViewport&&(window.visualViewport.removeEventListener("resize",o),window.visualViewport.removeEventListener("scroll",o)),window.removeEventListener("orientationchange",o)})),{availableTabs:l,switchTab:i,getBottomNavStyle:r,bottomSafeArea:a}}};const Ul=(0,u.A)(Al,[["render",Bl]]);var Ol=Ul,Jl={name:"HomeView",components:{LoadingOverlay:K,LeftView:ve,RightView:gt,MiddleView:_l,UpperView:Sa,ResponsiveLowerView:Ol},setup(){const e=R(),t=(0,c.KR)([]),a=(0,c.KR)(null),l=(0,c.KR)(null),o=(0,c.KR)(null),r=(0,c.KR)("d3js"),i=(0,c.KR)("table"),s=(0,c.KR)("layer-info"),d=(0,c.KR)("layers"),u=5,v=(0,c.KR)(20),g=(0,c.KR)(20),y=(0,c.KR)(window.innerWidth),m=(0,c.KR)(window.innerHeight),p=(0,c.KR)(0),h=(0,n.EW)((()=>`${v.value}%`)),f=(0,n.EW)((()=>`${g.value}%`)),b=(0,n.EW)((()=>100-v.value-g.value)),x=(0,n.EW)((()=>`${b.value}%`)),k=(0,n.EW)((()=>m.value-p.value)),w=(0,c.KR)("載入中..."),L=(0,c.KR)(0),T=(0,c.KR)(!1),C=(0,c.KR)(""),E=(0,n.EW)((()=>e.getAllLayers().some((e=>e.isLoading))));(0,n.wB)(E,(t=>{if(t){const t=e.getAllLayers().find((e=>e.isLoading));w.value=`載入 ${t.layerName} 數據中...`,C.value="正在處理地理資訊..."}else w.value="載入完成",C.value="數據已更新"}),{deep:!0});const D=(0,c.KR)(null),N=(0,c.KR)(11),I=(0,c.KR)({lat:25.033,lng:121.5654}),M=(0,c.KR)(0),F=(0,c.KR)(!1),_=()=>{console.log("MapTab已移除，resetView功能已停用")},X=(e,t)=>{t.preventDefault(),t.stopPropagation(),F.value=!0,document.body.classList.add("my-no-select");const a=t.clientX,l=v.value,o=g.value,n=y.value;console.log(`🔧 開始調整 ${e} 方向，初始值:`,{leftWidth:l,rightWidth:o});const r=t=>{t.preventDefault();const r=t.clientX-a,i=r/n*100;if("left"===e){let e=l+i;e=Math.max(u,Math.min(100-g.value,e)),v.value=e}else if("right"===e){let e=o-i;e=Math.max(0,Math.min(100-v.value,e)),g.value=e}},i=()=>{F.value=!1,document.body.classList.remove("my-no-select"),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",i),S(),console.log("✅ 拖曳調整完成，最終值:",{leftWidth:v.value,rightWidth:g.value,mainWidth:b.value})};document.addEventListener("mousemove",r),document.addEventListener("mouseup",i)},S=()=>{v.value=Math.max(u,Math.min(100,v.value)),g.value=Math.max(0,Math.min(100,g.value)),v.value=Math.round(10*v.value)/10,g.value=Math.round(10*g.value)/10},V=()=>{const e=y.value,t=e>=1200;y.value=window.innerWidth,m.value=window.innerHeight;const r=window.innerWidth>=1200;t!==r?(console.log("🔄 HomeView: 響應式斷點切換 "+(t?"桌面版→響應式":"響應式→桌面版")),A()):(0,n.dY)((()=>{setTimeout((()=>{r&&a.value?a.value.invalidateMapSize&&a.value.invalidateMapSize():!r&&l.value&&l.value.invalidateMapSize&&l.value.invalidateMapSize()}),100)})),(0,n.dY)((()=>{if(o.value&&window.innerWidth>=1200?p.value=o.value.offsetHeight:p.value=0,!r){const e=P();H.value<e&&(H.value=Math.round(e),console.log(`🔧 HomeView: 視窗大小變化，調整底部面板最小高度至 ${H.value}vh`))}}))};(0,n.sV)((()=>{console.log("🚀 Schematic Map平台已初始化"),window.addEventListener("resize",V),(0,n.dY)((()=>{o.value&&window.innerWidth>=1200?p.value=o.value.offsetHeight:p.value=0})),window.ResizeObserver&&(U=new ResizeObserver((e=>{for(let t of e){const{width:e}=t.contentRect,a=e>=1200,l=t.target.classList.contains("xl-and-above");a!==l&&(t.target.classList.toggle("xl-and-above",a),A())}})),U.observe(document.body))}));const j=e=>{M.value=e},$=t=>{console.log("HomeView - handleFeatureSelected called with:",{feature:t,properties:t.properties,store:e}),e.setSelectedFeature(t),console.log("HomeView - After setting selectedFeature:",{storeSelectedFeature:e.selectedFeature});const a=window.innerWidth>=1200;a?s.value="properties":(d.value="properties",H.value<30&&(H.value=40))},z=e=>{console.log("🎯 HomeView 處理高亮顯示:",e),"map"!==r.value&&(r.value="map"),(0,n.dY)((()=>{const t=window.innerWidth>=1200;t?a.value?a.value.highlightFeature(e):console.error("❌ 無法高亮顯示: middlePanelRef 不可用"):l.value?l.value.highlightFeature(e):console.error("❌ 無法高亮顯示: mobileUpperViewRef 不可用")}))},P=()=>{const e=100,t=window.innerHeight;return Math.max(10,e/t*100)},H=(0,c.KR)(Math.max(40,P())),W=(0,c.KR)(!1),K=(0,c.KR)(0),B=e=>{e.preventDefault(),e.stopPropagation(),W.value=!0,document.body.classList.add("my-no-select");const t=e.type.startsWith("touch"),a=t?e.touches[0].clientY:e.clientY,l=a,o=H.value,n=window.innerHeight;console.log("🔧 HomeView - 開始垂直調整",{startY:l,startBottomHeight:o,windowHeight:n,isTouch:t});const r=e=>{e.preventDefault();const t=e.type.startsWith("touch")?e.touches[0].clientY:e.clientY,a=t-l,r=a/n*100;let i=o-r;const s=P();i=Math.max(s,Math.min(100,i)),H.value=Math.round(i)},i=()=>{W.value=!1,document.body.classList.remove("my-no-select"),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",i),document.removeEventListener("touchmove",r),document.removeEventListener("touchend",i),document.removeEventListener("touchcancel",i),console.log("🔧 HomeView - 垂直調整結束",{finalHeight:H.value})};t?(document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("touchend",i),document.addEventListener("touchcancel",i)):(document.addEventListener("mousemove",r),document.addEventListener("mouseup",i))};(0,n.wB)(m,(()=>{setTimeout((()=>{K.value+=1}),100)}));const A=()=>{console.log("🔄 HomeView: 螢幕尺寸跨越斷點，重新初始化地圖"),K.value+=1,(0,n.dY)((()=>{setTimeout((()=>{const e=window.innerWidth>=1200;e?a.value&&(console.log("🖥️ HomeView: 切換到桌面版，處理 MiddleView 地圖"),a.value.invalidateMapSize&&a.value.invalidateMapSize(),setTimeout((()=>{const e=new Event("resize");window.dispatchEvent(e)}),100)):l.value&&(console.log("📱 HomeView: 切換到響應式版本，處理 UpperView 地圖"),l.value.invalidateMapSize&&l.value.invalidateMapSize())}),300)}))};let U=null;return(0,n.hi)((()=>{window.removeEventListener("resize",V),U&&U.disconnect()})),{middlePanelRef:a,activeUpperTab:r,activeBottomTab:i,activeRightTab:s,activeLowerTab:d,isAnyLayerLoading:E,loadingText:w,loadingProgress:L,showLoadingProgress:T,loadingSubText:C,selectedFilter:D,zoomLevel:N,currentCoords:I,activeMarkers:M,leftViewWidth:v,rightViewWidth:g,leftViewWidthPx:h,rightViewWidthPx:f,mainPanelWidth:b,mainPanelWidthPx:x,dataTableData:t,resetView:_,startResize:X,startVerticalResize:B,isSidePanelDragging:F,isVerticalDragging:W,mobileBottomViewHeight:H,mobileMapKey:K,validatePanelSizes:S,appFooterRef:o,mobileUpperViewRef:l,calculatedMiddleViewHeight:k,handleHighlight:z,updateActiveMarkers:j,handleFeatureSelected:$}}};const Gl=(0,u.A)(Jl,[["render",L]]);var Ql=Gl;const Yl=[{path:"/",name:"Home",component:Ql,meta:{title:"示意圖響應式網站",description:"Schematic Map系統的示意圖展示平台",requiresAuth:!1}}],ql=(0,y.aE)({history:(0,y.LA)("/schematic-map-rwd/"),routes:Yl,scrollBehavior(e,t,a){return a||{top:0}}});ql.beforeEach(((e,t,a)=>{e.meta.title?document.title=`${e.meta.title} - 示意圖響應式網站`:document.title="示意圖響應式網站",a()})),ql.afterEach((e=>{0}));var Zl=ql;a(323);console.log("🎨 樣式文件載入完成");const eo=(0,l.Ef)(g),to=(0,o.Ey)();eo.use(Zl),eo.use(to),eo.mount("#app"),console.log("🚀 Schematic Map平台已啟動"),console.log("📦 Pinia 狀態管理已初始化"),console.log("🗺️ Vue Router 路由系統已就緒"),console.log("🎨 Bootstrap 5 UI 框架已載入"),console.log("🔤 Font Awesome 圖示庫已載入")}},t={};function a(l){var o=t[l];if(void 0!==o)return o.exports;var n=t[l]={exports:{}};return e[l].call(n.exports,n,n.exports,a),n.exports}a.m=e,function(){var e=[];a.O=function(t,l,o,n){if(!l){var r=1/0;for(d=0;d<e.length;d++){l=e[d][0],o=e[d][1],n=e[d][2];for(var i=!0,s=0;s<l.length;s++)(!1&n||r>=n)&&Object.keys(a.O).every((function(e){return a.O[e](l[s])}))?l.splice(s--,1):(i=!1,n<r&&(r=n));if(i){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[l,o,n]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var l in t)a.o(t,l)&&!a.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,l){var o,n,r=l[0],i=l[1],s=l[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(s)var d=s(a)}for(t&&t(l);c<r.length;c++)n=r[c],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(d)},l=self["webpackChunkschematic_map_rwd"]=self["webpackChunkschematic_map_rwd"]||[];l.forEach(t.bind(null,0)),l.push=t.bind(null,l.push.bind(l))}();var l=a.O(void 0,[504],(function(){return a(532)}));l=a.O(l)})();
//# sourceMappingURL=app.b76c875b.js.map