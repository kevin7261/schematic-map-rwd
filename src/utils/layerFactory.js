/**
 * ğŸ­ åœ–å±¤å·¥å» æ¨¡çµ„ (Layer Factory Module)
 *
 * åŠŸèƒ½èªªæ˜ (Features):
 * 1. ğŸ—ï¸ å‹•æ…‹åœ–å±¤ç”Ÿæˆï¼šå‹•æ…‹ç”Ÿæˆåœ–å±¤ç¾¤çµ„é…ç½®
 * 2. ğŸ“Š æ•¸æ“šåœ–å±¤æ”¯æ´ï¼šå°ˆé–€è™•ç†ç¤ºæ„åœ–æ•¸æ“šåœ–å±¤çš„é…ç½®å’Œè¼‰å…¥
 * 3. ğŸ¨ è¦–è¦ºåŒ–é…ç½®ï¼šç‚ºä¸åŒåœ–å±¤é¡å‹æä¾›é©ç•¶çš„è¦–è¦ºåŒ–è¨­å®š
 * 4. ğŸ”§ æ¨¡çµ„åŒ–è¨­è¨ˆï¼šä½¿ç”¨å°å‹å»ºæ§‹å™¨å‡½æ•¸å»ºç«‹ä¸åŒé¡å‹çš„åœ–å±¤
 * 5. ğŸ“± éŸ¿æ‡‰å¼æ”¯æ´ï¼šç¢ºä¿åœ–å±¤é…ç½®é©é…ä¸åŒçš„é¡¯ç¤ºéœ€æ±‚
 *
 * æŠ€è¡“ç‰¹é» (Technical Features):
 * - æ¡ç”¨å·¥å» æ¨¡å¼è¨­è¨ˆï¼Œæä¾›çµ±ä¸€çš„åœ–å±¤å‰µå»ºä»‹é¢
 * - æ”¯æ´å‹•æ…‹é…ç½®ç”Ÿæˆï¼Œé©æ‡‰ä¸åŒçš„æ•¸æ“šæºå’Œéœ€æ±‚
 * - æ•´åˆæ•¸æ“šè™•ç†æ¨¡çµ„ï¼Œæä¾›å®Œæ•´çš„åœ–å±¤è¼‰å…¥æµç¨‹
 * - æä¾›æ¸…æ™°çš„ API ä»‹é¢ï¼Œç°¡åŒ–åœ–å±¤ç®¡ç†
 *
 * æ”¯æ´çš„åœ–å±¤é¡å‹ (Supported Layer Types):
 * - æ•¸æ“šåœ–å±¤ï¼šç¤ºæ„åœ–ç¯€é»æ•¸æ“šã€çµ±è¨ˆæ•¸æ“šç­‰ï¼ˆJSON æ ¼å¼ï¼‰
 *
 * è¨­è¨ˆåŸå‰‡ (Design Principles):
 * - å¯é…ç½®åŒ–ï¼šå°‡é…ç½®åƒæ•¸é›†ä¸­ç®¡ç†ï¼Œä¾¿æ–¼ç¶­è­·å’Œä¿®æ”¹
 * - å¯ç¶­è­·æ€§ï¼šä½¿ç”¨å°å‹å»ºæ§‹å™¨å‡½æ•¸ï¼Œé™ä½è¤‡é›œåº¦
 * - æ˜“é–±è®€ï¼šæä¾›è©³ç´°çš„ JSDoc è¨»è§£å’Œæ¸…æ™°çš„å‡½æ•¸å‘½å
 * - ç©©å®šæ€§ï¼šç¢ºä¿åœ–å±¤åˆ—è¡¨çš„æ’åºå’Œçµæ§‹ç©©å®š
 *
 * @file layerFactory.js
 * @version 2.0.0
 * @author Kevin Cheng
 * @since 1.0.0
 */

// ==================== ğŸ“¦ ç¬¬ä¸‰æ–¹åº«å¼•å…¥ (Third-Party Library Imports) ====================

/**
 * æ•¸æ“šè™•ç†æ¨¡çµ„å¼•å…¥
 * æä¾›åœ–å±¤æ•¸æ“šè¼‰å…¥å’Œè™•ç†çš„æ ¸å¿ƒåŠŸèƒ½
 *
 * @see ../dataProcessor.js
 */
import { loadDataLayerJson } from './dataProcessor.js';

// ==================== âš™ï¸ é…ç½®å¸¸æ•¸ (Configuration Constants) ====================

/**
 * åœ–å±¤é¡å‹é…ç½®å·²ç§»é™¤ï¼Œåªä¿ç•™æ•¸æ“šåœ–å±¤
 * ç°¡åŒ–æ¶æ§‹ï¼Œå°ˆæ³¨æ–¼ç¤ºæ„åœ–æ•¸æ“šçš„è™•ç†å’Œé¡¯ç¤º
 */

// ==================== ğŸ”§ è¼”åŠ©å‡½æ•¸ (Helper Functions) ====================

/**
 * ğŸ—ï¸ å‰µå»ºåŸºç¤åœ–å±¤é…ç½® (Create Base Layer Configuration)
 * å»ºç«‹åœ–å±¤çš„åŸºç¤é…ç½®ç‰©ä»¶ï¼ŒåŒ…å«æ‰€æœ‰åœ–å±¤å…±æœ‰çš„å±¬æ€§å’Œé è¨­å€¼
 *
 * åŠŸèƒ½èªªæ˜ï¼š
 * - æä¾›çµ±ä¸€çš„åœ–å±¤é…ç½®çµæ§‹
 * - è¨­å®šåˆç†çš„é è¨­å€¼ï¼Œç¢ºä¿åœ–å±¤åˆå§‹ç‹€æ…‹æ­£ç¢º
 * - æ”¯æ´ä¸åŒå¹¾ä½•é¡å‹çš„åœ–å±¤ï¼ˆé»ã€é¢ç­‰ï¼‰
 * - æä¾›è¦–è¦ºåŒ–ç›¸é—œçš„é…ç½®é¸é …
 *
 * @param {string} layerId - åœ–å±¤å”¯ä¸€è­˜åˆ¥ç¢¼ï¼Œç”¨æ–¼å€åˆ†ä¸åŒåœ–å±¤
 * @param {string} layerName - åœ–å±¤é¡¯ç¤ºåç¨±ï¼Œç”¨æ–¼ UI é¡¯ç¤º
 * @param {'point'|'polygon'} type - å¹¾ä½•é¡å‹ï¼Œå®šç¾©åœ–å±¤çš„ç©ºé–“ç‰¹å¾µ
 * @param {string} colorName - ä¸»è‰²åç¨±ï¼Œç”¨æ–¼å‰ç«¯ UI çš„é¡è‰²ä¸»é¡Œ
 * @returns {Object} åŸºç¤åœ–å±¤é…ç½®ç‰©ä»¶
 * @description è¿”å›åŒ…å«æ‰€æœ‰å¿…è¦å±¬æ€§çš„åœ–å±¤é…ç½®ç‰©ä»¶ï¼Œç”¨æ–¼å¾ŒçºŒçš„åœ–å±¤å‰µå»º
 * @example createBaseLayer('data_layer', 'æ•¸æ“šåœ–å±¤', 'point', 'purple')
 */
function createBaseLayer(layerId, layerName, type, colorName) {
  return {
    // åœ–å±¤åŸºæœ¬è­˜åˆ¥è³‡è¨Š
    layerId, // åœ–å±¤å”¯ä¸€è­˜åˆ¥ç¢¼
    layerName, // åœ–å±¤é¡¯ç¤ºåç¨±

    // åœ–å±¤ç‹€æ…‹ç®¡ç†
    visible: false, // åœ–å±¤æ˜¯å¦å¯è¦‹ï¼Œé è¨­ç‚ºéš±è—
    isLoading: false, // åœ–å±¤æ˜¯å¦æ­£åœ¨è¼‰å…¥ä¸­
    isLoaded: false, // åœ–å±¤æ˜¯å¦å·²è¼‰å…¥å®Œæˆ

    // åœ–å±¤å¹¾ä½•å’Œè¦–è¦ºåŒ–é…ç½®
    type, // å¹¾ä½•é¡å‹ï¼ˆpoint/polygonï¼‰
    shape: null, // åœ–å±¤å½¢ç‹€ï¼Œç”¨æ–¼ç‰¹æ®Šé¡¯ç¤ºéœ€æ±‚
    colorName, // ä¸»è‰²åç¨±ï¼Œç”¨æ–¼ UI ä¸»é¡Œ

    // åœ–å±¤æ•¸æ“šå­˜å„²
    jsonData: null, // JSON æ•¸æ“š
    summaryData: null, // åœ–å±¤æ‘˜è¦çµ±è¨ˆæ•¸æ“š
    tableData: null, // è¡¨æ ¼é¡¯ç¤ºç”¨çš„æ•¸æ“š
    legendData: null, // åœ–ä¾‹æ•¸æ“š
  };
}

/**
 * ğŸ“Š å‰µå»ºæ•¸æ“šåœ–å±¤é…ç½® (Create Data Layer Configuration)
 * å°ˆé–€ç”¨æ–¼å‰µå»ºç¤ºæ„åœ–æ•¸æ“šåœ–å±¤çš„é…ç½®ï¼ŒåŒ…å«ç‰¹æ®Šçš„è¼‰å…¥å’Œé¡¯ç¤ºè¨­å®š
 *
 * åŠŸèƒ½èªªæ˜ï¼š
 * - åŸºæ–¼åŸºç¤åœ–å±¤é…ç½®ï¼Œæ·»åŠ æ•¸æ“šåœ–å±¤ç‰¹æœ‰çš„å±¬æ€§
 * - è¨­å®šç‰¹æ®Šçš„æ•¸æ“šè¼‰å…¥å‡½æ•¸ï¼Œè™•ç†ç¤ºæ„åœ–ç¯€é»æ•¸æ“š
 * - é…ç½®ç‚ºä¸å¯åœ¨åœ°åœ–ä¸Šé¡¯ç¤ºï¼Œå°ˆç”¨æ–¼è¡¨æ ¼å’Œåœ–è¡¨å±•ç¤º
 * - æ”¯æ´ JSON æ ¼å¼çš„æ•¸æ“šæ–‡ä»¶è¼‰å…¥
 *
 * @param {string} layerId - åœ–å±¤å”¯ä¸€è­˜åˆ¥ç¢¼
 * @param {string} layerName - åœ–å±¤é¡¯ç¤ºåç¨±
 * @param {string} colorName - ä¸»è‰²åç¨±ï¼Œç”¨æ–¼ UI ä¸»é¡Œ
 * @param {string} dataFileName - JSON æ•¸æ“šæ–‡ä»¶åï¼Œç›¸å°æ–¼ /data/ ç›®éŒ„
 * @returns {Object} æ•¸æ“šåœ–å±¤é…ç½®ç‰©ä»¶
 * @description è¿”å›å°ˆé–€ç”¨æ–¼ç¤ºæ„åœ–æ•¸æ“šçš„åœ–å±¤é…ç½®ï¼ŒåŒ…å«è¼‰å…¥å‡½æ•¸å’Œé¡¯ç¤ºè¨­å®š
 * @example createDataLayer('data_layer', 'æ•¸æ“šåœ–å±¤', 'purple', 'data.json')
 */
function createDataLayer(layerId, layerName, colorName, dataFileName) {
  // å‰µå»ºåŸºç¤åœ–å±¤é…ç½®ï¼Œä½¿ç”¨ 'point' é¡å‹ï¼ˆé›–ç„¶ä¸åœ¨åœ°åœ–ä¸Šé¡¯ç¤ºï¼‰
  const baseLayer = createBaseLayer(layerId, layerName, 'point', colorName);

  return {
    // å±•é–‹åŸºç¤åœ–å±¤é…ç½®ï¼Œç¹¼æ‰¿æ‰€æœ‰åŸºæœ¬å±¬æ€§
    ...baseLayer,

    // æ•¸æ“šè¼‰å…¥é…ç½®
    jsonLoader: loadDataLayerJson, // ä½¿ç”¨å°ˆé–€çš„æ•¸æ“šè¼‰å…¥å‡½æ•¸
    jsonFileName: dataFileName, // æ•¸æ“šæ–‡ä»¶åç¨±

    // åœ–å±¤é¡å‹æ¨™è¨˜
    isDataLayer: true, // æ¨™è¨˜ç‚ºæ•¸æ“šåœ–å±¤ï¼Œç”¨æ–¼ç‰¹æ®Šè™•ç†é‚è¼¯
    hideFromMap: true, // æ¨™è¨˜ç‚ºä¸å¯åœ¨åœ°åœ–ä¸Šé¡¯ç¤ºï¼Œå°ˆç”¨æ–¼è¡¨æ ¼å±•ç¤º
  };
}

// ==================== ä¸»è¦å‡½æ•¸ ====================

/**
 * å‰µå»ºæ•¸æ“šåœ–å±¤é…ç½®ï¼ˆåªä¿ç•™æ•¸æ“šåœ–å±¤ï¼‰
 * @returns {{groupName:string, groupLayers:Array<object>}}
 */
export function createCityPopulationLayers() {
  // åªä¿ç•™æ•¸æ“šåœ–å±¤
  const dataLayer = createDataLayer('data_layer', 'æ•¸æ“šåœ–å±¤', 'purple', 'data.json');

  return {
    groupName: 'æ•¸æ“šåœ–å±¤',
    groupLayers: [dataLayer],
  };
}

// ==================== å‹•æ…‹åœ–å±¤ç”Ÿæˆ ====================

/**
 * å‹•æ…‹ç”Ÿæˆæ‰€æœ‰åœ–å±¤é…ç½®ï¼ˆåªä¿ç•™æ•¸æ“šåœ–å±¤ï¼‰
 * è¦å‰‡ï¼š
 * 1. æ•¸æ“šåœ–å±¤ç¾¤çµ„ï¼šåŒ…å«ç¤ºæ„åœ–æ•¸æ“šåœ–å±¤
 * @returns {Array<{groupName:string, subGroups:Array<object>}>}
 */
export function generateDynamicLayers() {
  const layers = [];

  // æ•¸æ“šåœ–å±¤ç¾¤çµ„
  const dataGroup = {
    groupName: 'æ•¸æ“šåœ–å±¤',
    subGroups: [createCityPopulationLayers()],
  };
  layers.push(dataGroup);

  return layers;
}

// ==================== è¼”åŠ©å‡½æ•¸ ====================
